<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS" 
    data-rh="true">
<meta property="og:description" 
    content="12 Months Ago: We created a Grafana Dashboard that monitors the successful / failed Daily Builds of Apache NuttX RTOS, across all 339 microcontroller boards. Today, let's migrate NuttX Dashboard from our Home Computer to Google Cloud VM."
    data-rh="true">
<meta name="description" 
    content="12 Months Ago: We created a Grafana Dashboard that monitors the successful / failed Daily Builds of Apache NuttX RTOS, across all 339 microcontroller boards. Today, let's migrate NuttX Dashboard from our Home Computer to Google Cloud VM.">
<meta property="og:image" 
    content="https://lupyuen.org/images/dashboard-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<link rel="canonical"
    href="https://lupyuen.org/articles/dashboard" />
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
    <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS</h1>
    <nav id="rustdoc"><ul>
<li><a href="#create-our-virtual-machine" title="Create Our Virtual Machine">1 Create Our Virtual Machine</a><ul></ul></li>
<li><a href="#install-grafana-oss-server" title="Install Grafana OSS Server">2 Install Grafana OSS Server</a><ul></ul></li>
<li><a href="#install-prometheus-server" title="Install Prometheus Server">3 Install Prometheus Server</a><ul></ul></li>
<li><a href="#install-prometheus-pushgateway" title="Install Prometheus Pushgateway">4 Install Prometheus Pushgateway</a><ul></ul></li>
<li><a href="#ingest-a-sample-nuttx-log" title="Ingest a Sample NuttX Log">5 Ingest a Sample NuttX Log</a><ul></ul></li>
<li><a href="#connect-grafana-to-prometheus" title="Connect Grafana to Prometheus">6 Connect Grafana to Prometheus</a><ul></ul></li>
<li><a href="#set-the-github-token" title="Set the GitHub Token">7 Set the GitHub Token</a><ul></ul></li>
<li><a href="#ingest-the-github-actions-logs" title="Ingest the GitHub Actions Logs">8 Ingest the GitHub Actions Logs</a><ul></ul></li>
<li><a href="#start-the-nuttx-mirror-build" title="Start the NuttX Mirror Build">9 Start the NuttX Mirror Build</a><ul></ul></li>
<li><a href="#forever-build-and-ingest" title="Forever Build and Ingest">10 Forever Build and Ingest</a><ul></ul></li>
<li><a href="#secure-our-grafana-server" title="Secure Our Grafana Server">11 Secure Our Grafana Server</a><ul></ul></li>
<li><a href="#cost-of-google-cloud" title="Cost of Google Cloud">12 Cost of Google Cloud</a><ul></ul></li>
<li><a href="#whats-next" title="What‚Äôs Next">13 What‚Äôs Next</a><ul></ul></li>
<li><a href="#appendix-nuttx-mirror-repo" title="Appendix: NuttX Mirror Repo">14 Appendix: NuttX Mirror Repo</a><ul></ul></li>
<li><a href="#appendix-ingest-the-github-gists" title="Appendix: Ingest the GitHub Gists">15 Appendix: Ingest the GitHub Gists</a><ul></ul></li>
<li><a href="#appendix-ssh-key-for-github" title="Appendix: SSH Key for GitHub">16 Appendix: SSH Key for GitHub</a><ul></ul></li>
<li><a href="#appendix-ssh-key-for-vm-login" title="Appendix: SSH Key for VM Login">17 Appendix: SSH Key for VM Login</a><ul></ul></li>
<li><a href="#appendix-remote-connect-in-vscode" title="Appendix: Remote Connect in VSCode">18 Appendix: Remote Connect in VSCode</a><ul></ul></li>
<li><a href="#appendix-expand-the-vm-disk" title="Appendix: Expand the VM Disk">19 Appendix: Expand the VM Disk</a><ul></ul></li>
<li><a href="#appendix-publish-online-with-cloudflare" title="Appendix: Publish Online with Cloudflare">20 Appendix: Publish Online with Cloudflare</a><ul></ul></li></ul></nav><p>üìù <em>14 Jan 2026</em></p>
<p><img src="https://lupyuen.org/images/dashboard-title.jpg" alt="Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS" /></p>
<p>12 Months Ago: We created a <strong>Grafana Dashboard</strong> (pic above) that monitors the successful / failed <strong>Daily Builds</strong> of <a href="https://nuttx.apache.org/docs/latest/index.html"><strong>Apache NuttX RTOS</strong></a>, across all 339 microcontroller boards. So we‚Äôll be alerted (via Mastodon) if NuttX fails to build for (say) RP2040‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.org/articles/ci4"><strong>‚ÄúContinuous Integration Dashboard for Apache NuttX RTOS‚Äù</strong></a></li>
</ul>
<p><em>Was everything hunky dory?</em></p>
<p>Nope! Grafana Dashboard was running on a (macOS) <strong>Home Computer</strong>. Thus if we‚Äôre overseas for <a href="https://lupyuen.org/articles/marathon#whats-next"><strong>Marathon Races</strong></a> and there‚Äôs a Home Power Outage‚Ä¶ NuttX Dashboard goes down and never recovers!</p>
<p>Today, let‚Äôs migrate NuttX Dashboard from our Home Computer to <strong>Google Cloud VM</strong>. It will cost more, and we don‚Äôt have the Hosting Budget. But at least NuttX Dashboard will continue running when the lights go poof.</p>
<p><em>What if we prefer another cloud? Or our own machine?</em></p>
<p>The steps below will work for any <strong>Debian Bookworm</strong> machine. Hopefully someday we‚Äôll budget for the machine. (And secure it too)</p>
<p><em>Will it be cheaper on an Asian Cloud? Like AliCloud?</em></p>
<p>Hmmm interesting‚Ä¶ We should <a href="https://web.archive.org/web/20191204194108/https://medium.com/@ly.lee/first-impressions-of-alibaba-cloud-aliyun-688dc46fa9b8?source=friends_link&amp;sk=0685f5028f4ce9575dfae9cc9515143d"><strong>try it sometime</strong></a>!</p>
<p><img src="https://lupyuen.org/images/dashboard-flow.jpg" alt="NuttX Dashboard" /></p>
<h1 id="create-our-virtual-machine"><a class="doc-anchor" href="#create-our-virtual-machine">¬ß</a>1 Create Our Virtual Machine</h1>
<p>We begin by creating a <strong>Google Cloud Project</strong> that will operate our VM (pic above). We named it <em>nuttx-dashboard</em>‚Ä¶</p>
<ul>
<li><a href="https://console.cloud.google.com/projectcreate"><strong>Create a Google Cloud Project</strong></a> <em>(console.cloud.google.com)</em></li>
</ul>
<p><img src="https://lupyuen.org/images/dashboard-vm1.png" alt="Create a Google Cloud Project" /></p>
<p>Then we create our <strong>Virtual Machine</strong>‚Ä¶</p>
<ol>
<li>
<p>Click <strong>‚ÄúSelect Project‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-vm2.png" alt="Select Project" /></p>
</li>
<li>
<p>Click <strong>‚ÄúCreate a VM‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-vm3.png" alt="Create a VM" /></p>
</li>
<li>
<p>Click <strong>‚ÄúCompute Engine API &gt; Enable‚Äù</strong> and wait a while</p>
<p><img src="https://lupyuen.org/images/dashboard-vm4.png" alt="Compute Engine API &gt; Enable" /></p>
</li>
<li>
<p>Fill in the <strong>Instance Name</strong> <em>‚Äúnuttx-dashboard-vm‚Äù</em>. Our VM shall be <strong>General Purpose / Debian Bookworm</strong></p>
<p>Set the <strong>Disk Size to 20 GB</strong> <a href="https://lupyuen.org/articles/dashboard#appendix-expand-the-vm-disk">(or expand it later)</a></p>
<p>Click <strong>‚ÄúCreate‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-vm5.png" alt="Create VM" /></p>
</li>
<li>
<p>Click <strong>‚ÄúConnect &gt; SSH‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-vm6.png" alt="Connect &gt; SSH" /></p>
</li>
<li>
<p>And SSH Console appears! Remember to <strong>Update and Upgrade</strong> the VM‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>sudo apt update
sudo apt upgrade</code></pre></div></li>
</ol>
<p><img src="https://lupyuen.org/images/dashboard-vm7.png" alt="SSH Console" /></p>
<p><em>Is there a simpler way to access our VM?</em></p>
<p>Yep just use an <strong>SSH Key with VSCode Remote</strong>‚Ä¶</p>
<ul>
<li>
<p><a href="https://lupyuen.org/articles/dashboard#appendix-ssh-key-for-vm-login"><strong>‚ÄúSSH Key for VM Login‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/articles/dashboard#appendix-remote-connect-in-vscode"><strong>‚ÄúRemote Connect in VSCode‚Äù</strong></a></p>
</li>
</ul>
<p><img src="https://lupyuen.org/images/dashboard-flow1.jpg" alt="Grafana OSS Server" /></p>
<h1 id="install-grafana-oss-server"><a class="doc-anchor" href="#install-grafana-oss-server">¬ß</a>2 Install Grafana OSS Server</h1>
<p>We‚Äôre ready to install <strong>Grafana OSS Server</strong>! Yep the thingy (pic above) that renders our NuttX Dashboard‚Ä¶</p>
<ul>
<li><a href="https://grafana.com/docs/grafana/latest/setup-grafana/installation/debian/#install-from-apt-repository"><strong>Install Grafana OSS on Debian</strong></a></li>
</ul>
<div class="example-wrap"><pre class="language-bash"><code>## Grafana OSS from https://apt.grafana.com (stable)
## Install the prerequisite packages
sudo apt-get install -y apt-transport-https wget

## Import the GPG key
sudo mkdir -p /etc/apt/keyrings/
wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg &gt; /dev/null

## Add a repository for stable releases
echo &quot;deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main&quot; | sudo tee -a /etc/apt/sources.list.d/grafana.list

## Update the list of available packages
sudo apt-get update

## Install the latest OSS release
sudo apt-get install grafana

## Configure grafana to start automatically using systemd
sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable grafana-server

## Start grafana-server
sudo /bin/systemctl start grafana-server

## Grafana Server is listening on http://localhost:3000
## &quot;tcp6 0 0 :::3000 :::* LISTEN&quot;
netstat -an | grep LISTEN</code></pre></div>
<p><em>How to access Grafana Server?</em></p>
<p>Grafana is listening at <strong>TCP Port 3000</strong>. We create a <strong>Firewall Rule</strong> to allow incoming packets for Port 3000‚Ä¶</p>
<ol>
<li>
<p>Grab the <strong>External IP Address</strong> for our VM‚Ä¶</p>
<p><strong>VM Instance &gt; External IP</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-grafana1.png" alt="VM Instance &gt; External IP" /></p>
</li>
<li>
<p>Allow Incoming Packets for TCP Port 3000‚Ä¶</p>
<p>Click <strong>VM Instance &gt; Set Up Firewall Rules</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-grafana2.png" alt="VM Instance &gt; Set Up Firewall Rules" /></p>
<p>Click <strong>Firewall Policies &gt; Create Firewall Rule</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-grafana3.png" alt="Firewall Policies &gt; Create Firewall Rule" /></p>
<p><strong>Name:</strong> allow-tcp-3000</p>
<p><strong>Targets:</strong> All instances in the network</p>
<p><strong>IPv4 Ranges:</strong> 0.0.0.0/0</p>
<p><strong>Protocol and Ports:</strong> TCP 3000</p>
<p>Click <strong>‚ÄúCreate‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-grafana4.png" alt="Create Firewall Rule" /></p>
<p><img src="https://lupyuen.org/images/dashboard-grafana5.png" alt="Create Firewall Rule" /></p>
<p>Verify our Firewall Rule‚Ä¶</p>
<p><img src="https://lupyuen.org/images/dashboard-grafana6.png" alt="Verify our Firewall Rule" /></p>
</li>
<li>
<p>Browse to port 3000 of our External IP Address‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:3000</code></pre></div>
<p><strong>Username:</strong> admin</p>
<p><strong>Password:</strong> admin</p>
<p><img src="https://lupyuen.org/images/dashboard-grafana7.png" alt="Grafana Login" /></p>
</li>
<li>
<p>Set the new password</p>
<p><img src="https://lupyuen.org/images/dashboard-grafana8.png" alt="Set the Grafana Password" /></p>
</li>
<li>
<p>And we‚Äôre in Grafana!</p>
<p><img src="https://lupyuen.org/images/dashboard-grafana9.png" alt="Grafana Home" /></p>
</li>
</ol>
<p>Our Grafana Dashboard needs data‚Ä¶</p>
<p><img src="https://lupyuen.org/images/dashboard-flow2.jpg" alt="Prometheus Server" /></p>
<h1 id="install-prometheus-server"><a class="doc-anchor" href="#install-prometheus-server">¬ß</a>3 Install Prometheus Server</h1>
<p><em>Where‚Äôs the data store for Grafana?</em></p>
<p>We‚Äôll install <a href="https://lupyuen.org/articles/ci4#prometheus-metrics"><strong>Prometheus Time-Series Database</strong></a> (pic above), to record the successful and failed builds of NuttX across all 339 microcontroller boards‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## From https://ecintelligence.ma/en/blog/complete-guide-to-prometheus-and-grafana-monitorin/
## Install Prometheus Server
sudo apt install prometheus

## Start Prometheus Server on boot
sudo systemctl enable prometheus

## Start Prometheus Server right now
sudo systemctl start prometheus

## Check the status of Prometheus Server
sudo systemctl status prometheus

## We should see...
## ‚óè prometheus.service - Monitoring system and time series database
## Loaded: loaded (/lib/systemd/system/prometheus.service; enabled; preset: enabled)
## Active: active (running)

## Verify that Prometheus is listening on TCP Port 9090
sudo ss -tlnp | grep -E &#39;9090|9100&#39;

## We should see...
## LISTEN 0 4096 *:9090 *:* users:((&quot;prometheus&quot;,pid=93392,fd=7))     
## LISTEN 0 4096 *:9100 *:* users:((&quot;prometheus-node&quot;,pid=93237,fd=3))

## Later we&#39;ll configure Prometheus...
## /etc/prometheus/prometheus.yml</code></pre></div>
<p>To see Prometheus: We create a <strong>Firewall Rule</strong> to allow incoming access to <strong>TCP Port 9090</strong>‚Ä¶</p>
<ol>
<li>
<p>Click <strong>‚ÄúVM Instance &gt; Set Up Firewall Rules‚Äù</strong></p>
</li>
<li>
<p>Click <strong>‚ÄúFirewall Policies &gt; Create Firewall Rule‚Äù</strong></p>
<p><strong>Name:</strong> allow-tcp-9090</p>
<p><strong>Targets:</strong> All instances in the network</p>
<p><strong>IPv4 Ranges:</strong> 0.0.0.0/0</p>
<p><strong>Protocol and Ports:</strong> TCP 9090</p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus1.png" alt="Create Firewall Rule" /></p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus2.png" alt="Create Firewall Rule" /></p>
</li>
<li>
<p>Click <strong>‚ÄúCreate‚Äù</strong>. Verify that Port 9090 is open‚Ä¶</p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus3.png" alt="Verify Port 9090" /></p>
</li>
<li>
<p>Prometheus appears when we browse to Port 9090 of our <strong>External IP Address</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9090</code></pre></div></li>
</ol>
<p><img src="https://lupyuen.org/images/dashboard-prometheus4.png" alt="Prometheus Web UI" /></p>
<p><em>Why Prometheus? Why not SQL Database?</em></p>
<p>Remember we got Zero Budget for hosting NuttX Dashboard? Prometheus seems to be the Cheapest Way of hosting Time-Series Data.</p>
<p><img src="https://lupyuen.org/images/dashboard-flow3.jpg" alt="Prometheus Pushgateway" /></p>
<h1 id="install-prometheus-pushgateway"><a class="doc-anchor" href="#install-prometheus-pushgateway">¬ß</a>4 Install Prometheus Pushgateway</h1>
<p><em>What‚Äôs this Prometheus Pushgateway?</em></p>
<p>Funny Thing about Prometheus: We can‚Äôt push Time-Series Data to Prometheus Server, and expect it to be stored. Instead we do this‚Ä¶</p>
<ol>
<li>
<p>We install <a href="https://lupyuen.org/articles/ci4#prometheus-metrics"><strong>Prometheus Pushgateway</strong></a> (as the in-memory Staging Area for Time-Series Data)</p>
</li>
<li>
<p>We push our <strong>Time-Series Data</strong> to Prometheus Pushgateway (over HTTP, pic above)</p>
</li>
<li>
<p><strong>Prometheus Server</strong> shall scrape our Time-Series Data from Pushgateway (and store the data)</p>
</li>
</ol>
<p>Here‚Äôs how we install <strong>Prometheus Pushgateway</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## From https://devopscube.com/setup-prometheus-pushgateway-vm/
wget https://github.com/prometheus/pushgateway/releases/download/v1.11.2/pushgateway-1.11.2.linux-amd64.tar.gz
tar xvf pushgateway-1.11.2.linux-amd64.tar.gz
mv pushgateway-1.11.2.linux-amd64 pushgateway
cd pushgateway/
sudo useradd -rs /bin/false pushgateway
sudo cp pushgateway /usr/local/bin/
sudo chown pushgateway:pushgateway /usr/local/bin/pushgateway

sudo --shell
cat &lt;&lt;EOT &gt; /etc/systemd/system/pushgateway.service
[Unit]
Description=Prometheus Pushgateway
Wants=network-online.target
After=network-online.target

[Service]
User=pushgateway
Group=pushgateway
Type=simple
ExecStart=/usr/local/bin/pushgateway

[Install]
WantedBy=multi-user.target
EOT
exit

sudo systemctl enable pushgateway
sudo systemctl start pushgateway
sudo systemctl status pushgateway

## We should see...
## pushgateway.service - Prometheus Pushgateway
## Loaded: loaded (/etc/systemd/system/pushgateway.service; enabled; preset: enabled)
## Active: active (running) since Mon 2026-01-05 08:46:49 UTC; 4s ago

curl localhost:9091/metrics

## We should see...
## HELP go_gc_duration_seconds A summary of the wall-time pause (stop-the-world) duration in garbage collection cycles.
## TYPE go_gc_duration_seconds summary</code></pre></div>
<p>Prometheus Pushgateway has an Admin UI at <strong>TCP Port 9091</strong>. We grant access‚Ä¶</p>
<ol>
<li>
<p>Click <strong>‚ÄúVM Instance &gt; Set Up Firewall Rules‚Äù</strong></p>
</li>
<li>
<p>Click <strong>‚ÄúFirewall Policies &gt; Create Firewall Rule‚Äù</strong></p>
<p><strong>Name:</strong> allow-tcp-9091</p>
<p><strong>Targets:</strong> All instances in the network</p>
<p><strong>IPv4 Ranges:</strong> 0.0.0.0/0</p>
<p><strong>Protocol and Ports:</strong> TCP 9091</p>
<p>Click <strong>‚ÄúCreate‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus5.png" alt="Create Firewall Rule" /></p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus6.png" alt="Create Firewall Rule" /></p>
<p><img src="https://lupyuen.org/images/dashboard-prometheus7.png" alt="Verify Firewall Rule" /></p>
</li>
<li>
<p>Prometheus Pushgateway appears on our External IP Address at‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9091</code></pre></div></li>
</ol>
<p><img src="https://lupyuen.org/images/dashboard-pushgateway1.png" alt="Prometheus Pushgateway Web UI" /></p>
<h1 id="ingest-a-sample-nuttx-log"><a class="doc-anchor" href="#ingest-a-sample-nuttx-log">¬ß</a>5 Ingest a Sample NuttX Log</h1>
<p>We‚Äôre all done with installation! Now we ingest some <strong>NuttX Build Logs</strong> to verify that Prometheus Server and Pushgateway are talking‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Download the Sample NuttX Build Log
pushd /tmp
wget https://github.com/lupyuen/ingest-nuttx-builds/releases/download/v1.0.0/defconfig.txt
wget https://github.com/lupyuen/ingest-nuttx-builds/releases/download/v1.0.0/ci-xtensa-02.log
popd

## Install Rust: https://rustup.rs/
## Press Enter for default option
curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
. &quot;$HOME/.cargo/env&quot;
sudo apt install gcc pkg-config libssl-dev

## Ingest the Sample NuttX Build Log into Prometheus Pushgateway
sudo apt install git
git clone https://github.com/lupyuen/ingest-nuttx-builds
cd ingest-nuttx-builds
cargo run \
  -- \
  --user NuttX \
  --repo nuttx \
  --defconfig /tmp/defconfig.txt \
  --file /tmp/ci-xtensa-02.log \
  --nuttx-hash 59f200ac4fe6c940dc0eab2155bb3cb566724082 \
  --apps-hash 4f93ec0a4335d574eeecfd295584fbfb17056e5b \
  --group xtensa-02 \
  --run-id 20706016275 \
  --job-id 59436813170 \
  --step 10

## We should see...
## lines[0]=Configuration/Tool: esp32s3-devkit/spi
## lines.last=  [1/1] Normalize esp32s3-devkit/spi
## target=esp32s3-devkit:spi
## timestamp=2026-01-05T08:39:57
## body=
## # TYPE build_score gauge
## # HELP build_score 1.0 for successful build, 0.0 for failed build
## build_score{ version=&quot;3&quot;, timestamp=&quot;2026-01-05T08:39:57&quot;, timestamp_log=&quot;2026-01-05T08:39:57&quot;, user=&quot;NuttX&quot;, arch=&quot;xtensa&quot;, subarch=&quot;esp32s3&quot;, group=&quot;xtensa-02&quot;, board=&quot;esp32s3-devkit&quot;, config=&quot;spi&quot;, target=&quot;esp32s3-devkit:spi&quot;, url=&quot;https://github.com/NuttX/nuttx/actions/runs/20706016275/job/59436813170#step:10:2455&quot;, url_display=&quot;&quot;, nuttx_hash=&quot;59f200ac4fe6c940dc0eab2155bb3cb566724082&quot;, apps_hash=&quot;4f93ec0a4335d574eeecfd295584fbfb17056e5b&quot; } 1
## res=Response { url: &quot;http://localhost:9091/metrics/job/NuttX/instance/esp32s3-devkit:spi&quot;, status: 200, headers: {&quot;date&quot;: &quot;Mon, 05 Jan 2026 10:10:52 GMT&quot;, &quot;content-length&quot;: &quot;0&quot;} }</code></pre></div>
<p>Browse to Prometheus Pushgateway at our <strong>External IP Address</strong>, port 9091. We‚Äôll see the <strong>NuttX Build Logs</strong> that we have ingested‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9091</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-pushgateway2.png" alt="Prometheus Pushgateway shows NuttX Build Logs" /></p>
<p>We configure <strong>Prometheus Server</strong> to talk to Pushgateway‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Edit the Prometheus Server Config
sudo nano /etc/prometheus/prometheus.yml

## Erase everything in the file. Replace by contents of
## https://github.com/lupyuen/ingest-nuttx-builds/blob/main/prometheus.yml

## Restart our Prometheus Server
sudo systemctl restart prometheus

## Which will scrape the Metrics from Prometheus Pushgateway every 15 seconds...
## global:
##   scrape_interval: 15s
## scrape_configs:
##   - job_name: &quot;prometheus&quot;
##     static_configs:
##     - targets: [&quot;localhost:9090&quot;]
##   - job_name: &quot;pushgateway&quot;
##     static_configs:
##     - targets: [&quot;localhost:9091&quot;]</code></pre></div>
<p><strong>Wait One Minute:</strong> Prometheus Server shall scrape and store the Ingested Build Logs from Pushgateway.</p>
<p>Browse to Prometheus Server at our <strong>External IP Address</strong>, port 9090‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9090</code></pre></div>
<p>Enter this Prometheus Query‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>build_score</code></pre></div>
<p>And click <strong>‚ÄúExecute‚Äù</strong>. Yep Prometheus Server has successfully scraped and stored the <strong>NuttX Build Logs</strong> from Pushgateway yay!</p>
<p><img src="https://lupyuen.org/images/dashboard-pushgateway3.png" alt="Prometheus Server has successfully scraped and stored the NuttX Build Logs from Pushgateway" /></p>
<h1 id="connect-grafana-to-prometheus"><a class="doc-anchor" href="#connect-grafana-to-prometheus">¬ß</a>6 Connect Grafana to Prometheus</h1>
<p><em>How will Grafana Dashboard talk to our Prometheus Database?</em></p>
<ol>
<li>
<p>Inside Grafana: Click <strong>‚ÄúMenu &gt; Data Sources &gt; Prometheus‚Äù</strong>.</p>
</li>
<li>
<p>Set the <strong>Prometheus Server URL</strong> to‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://localhost:9090</code></pre></div>
<p><img src="https://lupyuen.org/images/ci4-datasource.png" alt="Prometheus Data Source" /></p>
</li>
<li>
<p>Click <strong>‚ÄúDashboards &gt; New &gt; New Dashboard‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/ci4-grafana3.png" alt="Dashboards &gt; New &gt; New Dashboard" /></p>
</li>
<li>
<p>Click <strong>‚ÄúSettings &gt; JSON Model‚Äù</strong></p>
<p>Copy and overwrite the Dashboard JSON from here: <a href="https://github.com/lupyuen/ingest-nuttx-builds/blob/main/dashboard.json"><strong>dashboard.json</strong></a></p>
<p><img src="https://lupyuen.org/images/dashboard-json1.png" alt="Settings &gt; JSON Model" /></p>
</li>
<li>
<p>But change ALL references to <strong>Prometheus UID</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-json"><code>...
&quot;datasource&quot;: {
  &quot;type&quot;: &quot;prometheus&quot;,
  &quot;uid&quot;: &quot;df998a9io0yrkb&quot;
}
...</code></pre></div>
<p>(Get the UID from the Dashboard JSON before overwriting it)</p>
</li>
<li>
<p>Allow everyone to view: Click <strong>‚ÄúSettings &gt; Add Permission &gt; Role &gt; Viewer &gt; View‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-json5.png" alt="Settings &gt; Add Permission &gt; Role &gt; Viewer &gt; View" /></p>
</li>
<li>
<p>Save the dashboard. That‚Äôs our First Dashboard: <strong>‚ÄúBuild Logs Dashboard‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-json2.png" alt="Build Logs Dashboard" /></p>
</li>
<li>
<p>Once Again: Click <strong>‚ÄúDashboards &gt; New &gt; New Dashboard‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/ci4-grafana3.png" alt="Dashboards &gt; New &gt; New Dashboard" /></p>
</li>
<li>
<p>Click <strong>‚ÄúSettings &gt; JSON Model‚Äù</strong></p>
<p>Copy and overwite the Dashboard History JSON from here: <a href="https://github.com/lupyuen/ingest-nuttx-builds/blob/main/dashboard-history.json"><strong>dashboard-history.json</strong></a></p>
<p><img src="https://lupyuen.org/images/dashboard-json3.png" alt="TSettings &gt; JSON ModelODO" /></p>
</li>
<li>
<p>But change ALL references to <strong>Prometheus UID</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-json"><code>...
&quot;datasource&quot;: {
  &quot;type&quot;: &quot;prometheus&quot;,
  &quot;uid&quot;: &quot;df998a9io0yrkb&quot;
}
...</code></pre></div>
<p>(Get the UID from the Dashboard JSON before overwriting it)</p>
</li>
<li>
<p>Allow everyone to view: Click <strong>‚ÄúSettings &gt; Add Permission &gt; Role &gt; Viewer &gt; View‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-json6.png" alt="Settings &gt; Add Permission &gt; Role &gt; Viewer &gt; View" /></p>
</li>
<li>
<p>Save the dashboard. That‚Äôs our Second and Final Dashboard: <strong>‚ÄúNuttX Build History Dashboard‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-json4.png" alt="NuttX Build History Dashboard" /></p>
</li>
</ol>
<p>Let‚Äôs integrate our dashboard with GitHub Actions‚Ä¶</p>
<p><img src="https://lupyuen.org/images/dashboard-flow4.jpg" alt="Ingest the GitHub Actions Logs" /></p>
<h1 id="set-the-github-token"><a class="doc-anchor" href="#set-the-github-token">¬ß</a>7 Set the GitHub Token</h1>
<p><em>What‚Äôs this GitHub Token?</em></p>
<p>Our VM shall download and ingest the <strong>GitHub Actions Logs</strong>. This requires a GitHub Token to access the GitHub Actions Logs.</p>
<p>Inside our VM: Create <em>$HOME/github-token.sh</em> and fill in the <strong>GitHub Token</strong>. Any Plain GitHub Account will do (like <em>nuttxpr</em>). Don‚Äôt use an Admin Account!</p>
<div class="example-wrap"><pre class="language-bash"><code>## GitHub Settings &gt; Developer Settings &gt; Tokens (Classic) &gt; Generate New Token (Classic)
## Check the following:
## repo (Full control of private repositories)
## repo:status (Access commit status)
## repo_deployment (Access deployment status)
## public_repo (Access public repositories)
## repo:invite (Access repository invitations)
## security_events (Read and write security events)
export GITHUB_TOKEN=...

## Enable Rust Logging
export RUST_LOG=info 
export RUST_BACKTRACE=1</code></pre></div>
<p>If we‚Äôre ingesting <a href="https://lupyuen.org/articles/ci2#build-nuttx-for-all-target-groups"><strong>GitLab Snippets</strong></a>: Create <em>$HOME/gitlab-token.sh</em> and fill in the <strong>GitLab Token</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## User Settings &gt; Access tokens
## Select scopes:
## api: Grants complete read/write access to the API, including all groups and projects, the container registry, the dependency proxy, and the package registry.
export GITLAB_TOKEN=...
export GITLAB_USER=lupyuen
export GITLAB_REPO=nuttx-build-log</code></pre></div>
<p>Make sure that <em>nuttxpr</em> has <strong>Push Permission</strong> for NuttX Mirror Repo‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.org/articles/dashboard#appendix-nuttx-mirror-repo"><strong>‚ÄúNuttX Mirror Repo‚Äù</strong></a></li>
</ul>
<p><img src="https://lupyuen.org/images/dashboard-flow4.jpg" alt="Ingest the GitHub Actions Logs" /></p>
<h1 id="ingest-the-github-actions-logs"><a class="doc-anchor" href="#ingest-the-github-actions-logs">¬ß</a>8 Ingest the GitHub Actions Logs</h1>
<p>We have a <a href="https://github.com/NuttX/nuttx"><strong>NuttX Mirror Repo</strong></a> <em>(github.com/NuttX/nuttx)</em> that will run <a href="https://lupyuen.org/articles/ci3#move-the-merge-jobs"><strong>Daily Builds of NuttX</strong></a> across all 339 microcontroller boards.</p>
<p>Let‚Äôs ingest the <strong>GitHub Actions Logs</strong> (pic above) from the Mirror Repo Builds. Inside our VM: Do this‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Install GitHub CLI: https://github.com/cli/cli/blob/trunk/docs/install_linux.md#debian
(type -p wget &gt;/dev/null || (sudo apt update &amp;&amp; sudo apt install wget -y)) \
  &amp;&amp; sudo mkdir -p -m 755 /etc/apt/keyrings \
  &amp;&amp; out=$(mktemp) &amp;&amp; wget -nv -O$out https://cli.github.com/packages/githubcli-archive-keyring.gpg \
  &amp;&amp; cat $out | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg &gt; /dev/null \
  &amp;&amp; sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg \
  &amp;&amp; sudo mkdir -p -m 755 /etc/apt/sources.list.d \
  &amp;&amp; echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main&quot; | sudo tee /etc/apt/sources.list.d/github-cli.list &gt; /dev/null \
  &amp;&amp; sudo apt update \
  &amp;&amp; sudo apt install gh -y
. $HOME/github-token.sh
gh auth status

## We should see...
## ‚úì Logged in to github.com account nuttxpr (GITHUB_TOKEN)
## - Active account: true
## - Git operations protocol: https
## - Token: ghp_************************************
## - Token scopes: &#39;read:org&#39;, &#39;repo&#39;

## github.sh needs the NuttX defconfigs here (yeah we should fix the hardcoded &quot;riscv&quot;)
mkdir $HOME/riscv
pushd $HOME/riscv
git clone https://github.com/apache/nuttx
popd

## Ingest the GitHub Actions Logs
## https://github.com/lupyuen/ingest-nuttx-builds/blob/main/github.sh
sudo apt install unzip
cd
git clone https://github.com/lupyuen/ingest-nuttx-builds
cd ingest-nuttx-builds
./github.sh</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/8cf82eab994c2bca77f129ffa118acf0">(See the log for github.sh)</a></p>
<ol>
<li>
<p>Check <strong>Prometheus Pushgateway</strong> at our External IP Address, port 9091. We should see the logs ingested from GitHub Actions‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9091</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ingest1.png" alt="Prometheus Pushgateway shows the logs ingested from GitHub Actions" /></p>
</li>
<li>
<p>Check <strong>Prometheus Server</strong> at our External IP Address, port 9090. Enter the Prometheus Query <strong>‚Äúbuild_score‚Äù</strong>, click <strong>Execute</strong>. We‚Äôll see the same logs‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:9090</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ingest2.png" alt="Prometheus Server shows the logs ingested from GitHub Actions" /></p>
<p><strong>Bonus:</strong> This query will reveal that NuttX has 339 microcontroller boards: <strong>‚Äúcount by (board) (build_score)‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-ingest5.png" alt="This query will reveal that NuttX has 339 microcontroller boards" /></p>
</li>
<li>
<p>Check <strong>Grafana Dashboard</strong> at our External IP Address, port 3000. We‚Äôll see the GitHub Actions Logs‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:3000/d/fe2bqg6uk7nr4a</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ingest3.png" alt="Grafana Dashboard shows the logs ingested from GitHub Actions" /></p>
</li>
<li>
<p>Finally check the <strong>Build History</strong></p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x:3000/d/fe2q876wubc3kc</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ingest4.png" alt="Build History Dashboard" /></p>
</li>
</ol>
<h1 id="start-the-nuttx-mirror-build"><a class="doc-anchor" href="#start-the-nuttx-mirror-build">¬ß</a>9 Start the NuttX Mirror Build</h1>
<p><em>What triggers the Daily Build at NuttX Mirror Repo?</em></p>
<p>Our script <a href="https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh"><em>sync-build-ingest.sh</em></a> will trigger the <strong>Daily Build</strong>, followed by the ingestion of the GitHub Actions Logs.</p>
<p>Only one instance of <a href="https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh"><em>sync-build-ingest.sh</em></a> should ever be running! Make sure <em>lupyuen</em> isn‚Äôt running it on his Home Computer.</p>
<p>Inside our VM: Do this‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Set the GitHub Token
. $HOME/github-token.sh
gh auth status

## We should see...
## ‚úì Logged in to github.com account nuttxpr (GITHUB_TOKEN)
## - Active account: true
## - Git operations protocol: https
## - Token: ghp_************************************
## - Token scopes: &#39;read:org&#39;, &#39;repo&#39;

## Configure the Git User
git config --global user.email &quot;nuttxpr@gmail.com&quot;
git config --global user.name &quot;nuttxpr (nuttx-dashboard-vm)&quot;

## Start the NuttX Mirror Build and ingest the logs from GitHub Actions
## https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh
cd
git clone https://github.com/lupyuen/nuttx-release
cd $HOME/nuttx-release
./sync-build-ingest.sh

## If we see: &quot;**** ERROR: Expected Downstream Commit to be &#39;Enable macOS Builds&#39; but found: ...&quot;
## Then run this instead:
## ./enable-macos-windows.sh
## ./sync-build-ingest.sh</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/c9dd83842ab9b845eadedb968bd63bc1">(Log for sync-build-ingest.sh)</a></p>
<p><a href="https://gist.github.com/lupyuen/3d21869dae705d6c9d3acc1e8d94ffd1">(Log for enable-macos-windows.sh)</a></p>
<p>We‚Äôll see the <strong>‚ÄúEnable macOS Patch‚Äù</strong> that starts the NuttX Build‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>https://github.com/NuttX/nuttx/commits/master/</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-github15.png" alt="Enable macOS Patch" /></p>
<p>And the <strong>NuttX Build</strong> should be running‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>https://github.com/NuttX/nuttx/actions/workflows/build.yml</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-github16.png" alt="NuttX Build should be running" /></p>
<p>If the Patching and Building ain‚Äôt happening: Go to <a href="https://github.com/NuttX/nuttx"><em>github.com/NuttX/nuttx</em></a>, click <strong>‚ÄúSync Fork &gt; Update Branch (or Discard Commit)‚Äù</strong> (pic below). Then run <a href="https://github.com/lupyuen/nuttx-release/blob/main/enable-macos-windows.sh"><em>enable-macos-windows.sh</em></a> followed by <a href="https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh"><em>sync-build-ingest.sh</em></a>.</p>
<p><img src="https://lupyuen.org/images/dashboard-github7.png" alt="Sync Fork &gt; Update Branch (or Discard Commit)" /></p>
<p>If we see this error‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>fatal: cannot create directory at &#39;arch/arm/src/kinetis&#39;:
No space left on device
warning: Clone succeeded, but checkout failed.</code></pre></div>
<p>Then increase the Disk Space, we need 5 GB for <em>/tmp</em>‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.org/articles/dashboard#appendix-expand-the-vm-disk"><strong>‚ÄúExpand the VM Disk‚Äù</strong></a></li>
</ul>
<h1 id="forever-build-and-ingest"><a class="doc-anchor" href="#forever-build-and-ingest">¬ß</a>10 Forever Build and Ingest</h1>
<p>Everything We‚Äôve Done for NuttX Build and Ingest: Needs to be looped forever. Edit <em>$HOME/sync.sh</em> and fill this in‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>#!/usr/bin/env bash
## Sync NuttX Mirror, Build NuttX Mirror and Ingest GitHub Actions Logs

set -x  #  Echo commands
. $HOME/github-token.sh
gh auth status

for (( ; ; )); do
  cd $HOME/nuttx-release
  ./sync-build-ingest.sh

  set +x ; echo &quot;**** sync.sh: Waiting&quot; ; set -x
  date ; sleep 900
done</code></pre></div>
<p>Whenever our VM Boots: Run <em>$HOME/sync.sh</em>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Don&#39;t use cron, need to monitor manually so that
## we don&#39;t overuse the GitHub Runners of the Mirror Repo
sudo apt install tmux
tmux
chmod +x $HOME/sync.sh
$HOME/sync.sh

## If the SSH Session Disconnects:
## Do this to reconnect the sync.sh session...
## tmux a</code></pre></div>
<p><a href="https://github.com/lupyuen/nuttx-release/releases/download/v1.0.0/sync.log">(Log for NuttX Build and Ingest)</a></p>
<p><strong>One More Step:</strong> We need to ingest the GitHub Gists and GitLab Snippets‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.org/articles/dashboard#appendix-ingest-the-github-gists"><strong>‚ÄúIngest the GitHub Gists‚Äù</strong></a></li>
</ul>
<p><strong>In Case of Sync Problems:</strong> Go to <a href="https://github.com/NuttX/nuttx"><em>github.com/NuttX/nuttx</em></a>, click <strong>‚ÄúSync Fork &gt; Update Branch (or Discard Commit)‚Äù</strong>. Then run <a href="https://github.com/lupyuen/nuttx-release/blob/main/enable-macos-windows.sh"><em>enable-macos-windows.sh</em></a> followed by <em>sync.sh</em>. <em>(Hmmm this seems to happen often in our VM. Why?)</em></p>
<h1 id="secure-our-grafana-server"><a class="doc-anchor" href="#secure-our-grafana-server">¬ß</a>11 Secure Our Grafana Server</h1>
<p>We‚Äôre ready to Go Live! We tweak some Grafana Settings to make NuttX Dashboard more secure.</p>
<p>Inside our VM: Edit <em>/etc/grafana/grafana.ini</em>. Look for these settings and change them (don‚Äôt add them)</p>
<div class="example-wrap"><pre class="language-bash"><code># Default UI theme (&quot;dark&quot;, &quot;light&quot; or &quot;system&quot;)
# Default: default_theme = dark
default_theme = light

# Path to a custom home page. Users are only redirected to this if the default home dashboard is used. It should match a frontend route and contain a leading slash.
# Default: home_page =
home_page = /d/fe2bqg6uk7nr4a

# Disable usage of Grafana build-in login solution.
# Default: disable_login = false
disable_login = true

# Set to true to disable (hide) the login form, useful if you use OAuth, defaults to false
disable_login_form = true

# enable anonymous access
# Default: enabled = false
enabled = true

# specify organization name that should be used for unauthenticated users
org_name = Main Org.

# specify role for unauthenticated users
org_role = Viewer

# mask the Grafana version number for unauthenticated users
# Default: hide_version = false
hide_version = true</code></pre></div>
<p><a href="https://github.com/lupyuen/ingest-nuttx-builds/blob/main/grafana2.ini">(See the modified grafana.ini)</a></p>
<p>Restart Grafana‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>sudo systemctl restart grafana-server</code></pre></div>
<p>Publish online our NuttX Dashboard with Cloudflare Tunnel or another CDN‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.org/articles/dashboard#appendix-publish-online-with-cloudflare"><strong>‚ÄúPublish Online with Cloudflare‚Äù</strong></a></li>
</ul>
<p><img src="https://lupyuen.org/images/dashboard-title.jpg" alt="Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS" /></p>
<p>NuttX Dashboard is ready to serve. Yay!</p>
<p><img src="https://lupyuen.org/images/dashboard-cost1.png" alt="Cost of Google Cloud VM" /></p>
<h1 id="cost-of-google-cloud"><a class="doc-anchor" href="#cost-of-google-cloud">¬ß</a>12 Cost of Google Cloud</h1>
<p><em>Hosting our dashboard on Google Cloud: Is it expensive?</em></p>
<p>NuttX Dashboard on <strong>Google Cloud VM</strong> (pic above) is costing us‚Ä¶</p>
<ul>
<li>
<p><strong>USD 1.24</strong> per day</p>
</li>
<li>
<p><strong>USD 38</strong> per month</p>
</li>
<li>
<p><strong>USD 453</strong> per year</p>
</li>
</ul>
<p>Since we have <strong>Zero Budget</strong> for NuttX Dashboard: We‚Äôll pay this out of our own pocket.</p>
<blockquote>
<p><img src="https://lupyuen.org/images/dashboard-cost2.png" alt="Google recommends that we bump up the VM Capacity, increasing 16 SGD per month. Yikes!" /></p>
</blockquote>
<p><em>How‚Äôs our VM Utilisation?</em></p>
<p>Our VM runs continuously at <strong>50% CPU</strong> (pic above), forever busy ingesting the NuttX Build Logs.</p>
<p>Google recommends that we bump up the VM Capacity, <strong>increasing USD 16</strong> per month. Yikes!</p>
<p><em>Will it be cheaper on an Asian Cloud? Like AliCloud?</em></p>
<p>Hmmm interesting‚Ä¶ We should <a href="https://web.archive.org/web/20191204194108/https://medium.com/@ly.lee/first-impressions-of-alibaba-cloud-aliyun-688dc46fa9b8?source=friends_link&amp;sk=0685f5028f4ce9575dfae9cc9515143d"><strong>try it sometime</strong></a>!</p>
<p><img src="https://lupyuen.org/images/dashboard-marathon.png" alt="42 km Singapore Marathon - Completed yay!" /></p>
<p><a href="https://www.strava.com/activities/16671391778/overview"><em>42 km Singapore Marathon - Completed yay!</em></a></p>
<h1 id="whats-next"><a class="doc-anchor" href="#whats-next">¬ß</a>13 What‚Äôs Next</h1>
<p>Now that NuttX Dashboard is running in the Cloud (and not at Home)‚Ä¶ We‚Äôre going overseas for <a href="https://lupyuen.org/articles/marathon#whats-next"><strong>Twincity Marathon</strong></a>!</p>
<p><em>Anything else we‚Äôre running on our Home Computer?</em></p>
<p>Yeah sadly these home-based <strong>NuttX Monitoring Jobs</strong> will probably stop running while we‚Äôre overseas for Marathon Races‚Ä¶</p>
<ul>
<li>
<p><a href="https://lupyuen.org/articles/ci2"><strong>NuttX Build Farm</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/articles/ci3#live-metric-for-full-time-runners"><strong>Live Metric for GitHub Runners</strong></a></p>
</li>
<li>
<p><strong>Daily Tests of NuttX</strong> on <a href="https://gist.github.com/search?o=desc&amp;q=user%3Anuttxpr+%22daily-build-test-avaota%22&amp;s=updated"><strong>Avaota-A1</strong></a>, <a href="https://gist.github.com/search?o=desc&amp;q=user%3Anuttxpr+%22daily-build-test-starpro64%22&amp;s=updated"><strong>StarPro64</strong></a>, <a href="https://gist.github.com/search?o=desc&amp;q=user%3Anuttxpr+%22daily-build-test-oz64%22&amp;s=updated"><strong>Oz64</strong></a>, <a href="https://github.com/lupyuen/nuttx-riscv64/releases"><strong>RISC-V</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/articles/mastodon"><strong>Mastodon for NuttX CI</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/articles/forgejo"><strong>Forgejo for NuttX</strong></a></p>
</li>
</ul>
<p><em>Can‚Äôt we run NuttX Build Farm in the Cloud?</em></p>
<p>Noooo‚Ä¶. Too expensive! Much cheaper with a <a href="https://qoto.org/@lupyuen/113517788288458811"><strong>Refurbished Ubuntu Xeon Server</strong></a>.</p>
<p><img src="https://lupyuen.org/images/ci4-thinkstation.jpg" alt="Refurbished 12-Core Xeon ThinkStation ($400 / 24 kg!) becomes (hefty) Ubuntu Build Farm for Apache NuttX RTOS. 4 times the throughput of a PC!" /></p>
<span style="font-size:80%">
<p><a href="https://qoto.org/@lupyuen/113517788288458811"><em>Refurbished 12-Core Xeon ThinkStation ($400 / 24 kg!) becomes (hefty) Ubuntu Build Farm for Apache NuttX RTOS. 4 times the throughput of a PC!</em></a></p>
</span>
<p>Special Thanks to <a href="https://lupyuen.org/articles/sponsor"><strong>My Sponsors</strong></a> for supporting my writing. Your support means so much to me üôè</p>
<ul>
<li>
<p><a href="https://lupyuen.org/articles/sponsor"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://news.ycombinator.com/item?id=46615707"><strong>Discuss this article on Hacker News</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-avaota-a1"><strong>My Current Project: ‚ÄúApache NuttX RTOS for Avaota-A1‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-starpro64"><strong>Also My Current Project: ‚ÄúApache NuttX RTOS for StarPro64 EIC7700X‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/nuttx-sg2000"><strong>My Other Project: ‚ÄúNuttX for Oz64 SG2000‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/nuttx-ox64"><strong>Older Project: ‚ÄúNuttX for Ox64 BL808‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/pinephone-nuttx"><strong>Olderer Project: ‚ÄúNuttX for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://codeberg.org/lupyuen/lupyuen.org/src/branch/master/src/dashboard.md"><strong>lupyuen.org/src/dashboard.md</strong></a></p>
<p><img src="https://lupyuen.org/images/dashboard-flow4.jpg" alt="NuttX Mirror Repo" /></p>
<h1 id="appendix-nuttx-mirror-repo"><a class="doc-anchor" href="#appendix-nuttx-mirror-repo">¬ß</a>14 Appendix: NuttX Mirror Repo</h1>
<p><em>What triggers the Daily Build at NuttX Mirror Repo?</em></p>
<p>Our script <a href="https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh"><em>sync-build-ingest.sh</em></a> will trigger the <strong>Daily Build</strong>, followed by the ingestion of the GitHub Actions Logs.</p>
<p>Inside the script: Our Regular GitHub Account <em>nuttxpr</em> will start the build by pushing a patch to the NuttX Mirror Repo (pic above). This is how we grant the <strong>Push Permission</strong> to <em>nuttxpr</em>‚Ä¶</p>
<ol>
<li>
<p>Browse to the Collaborators for NuttX Mirror Repo</p>
<div class="example-wrap"><pre class="language-bash"><code>https://github.com/NuttX/nuttx/settings/access</code></pre></div></li>
<li>
<p>Click <strong>‚ÄúAdd People‚Äù</strong></p>
<p>Enter <strong>nuttxpr</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-github8.png" alt="Add People" /></p>
</li>
<li>
<p>Set the Role to <strong>‚ÄúWrite‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-github9.png" alt="Set the Role to ‚ÄúWrite‚Äù" /></p>
<p><img src="https://lupyuen.org/images/dashboard-github10.png" alt="Set the Role to ‚ÄúWrite‚Äù" /></p>
</li>
<li>
<p>Log in as <em>nuttxpr</em> to accept the invitation</p>
<p><img src="https://lupyuen.org/images/dashboard-github11.png" alt="Accept the invitation" /></p>
<p><img src="https://lupyuen.org/images/dashboard-github12.png" alt="Accept the invitation" /></p>
<p><img src="https://lupyuen.org/images/dashboard-github13.png" alt="Accept the invitation" /></p>
</li>
<li>
<p>Check that <em>nuttxpr</em> has become a collaborator</p>
<div class="example-wrap"><pre class="language-bash"><code>https://github.com/NuttX/nuttx/settings/access</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-github14.png" alt="Check collaborators" /></p>
</li>
</ol>
<p><img src="https://lupyuen.org/images/dashboard-flow5.jpg" alt="Ingest the GitHub Gists" /></p>
<h1 id="appendix-ingest-the-github-gists"><a class="doc-anchor" href="#appendix-ingest-the-github-gists">¬ß</a>15 Appendix: Ingest the GitHub Gists</h1>
<p><em>What‚Äôs with the GitHub Gists and GitLab Snippets?</em></p>
<p>We have a <a href="https://lupyuen.org/articles/ci2"><strong>NuttX Build Farm</strong></a> hosted at home (pic above). Our Build Farm will build NuttX all day, and record the <strong>Build Logs</strong> into GitHub Gists or GitLab Snippets. We run the script below to ingest the Build Logs into NuttX Dashboard. <a href="https://lupyuen.org/articles/dashboard#set-the-github-token">(Remember to set GitLab Token)</a></p>
<p>Whenever our VM Boots: Do this‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Ingest the GitHub Gists and GitLab Snippets
## https://github.com/lupyuen/ingest-nuttx-builds/blob/main/run.sh
tmux
cd $HOME/ingest-nuttx-builds
./run.sh

## If the SSH Session Disconnects:
## Do this to reconnect the run.sh session...
## tmux a

## Don&#39;t use cron, need to monitor manually so that we don&#39;t 
## overuse the GitHub API and GitLab API</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/d29be01f9e5ad256c6bb6df1e1ddea6d">(Log for ingest-nuttx-builds/run.sh)</a></p>
<p><img src="https://lupyuen.org/images/dashboard-flow4.jpg" alt="SSH Key for GitHub" /></p>
<h1 id="appendix-ssh-key-for-github"><a class="doc-anchor" href="#appendix-ssh-key-for-github">¬ß</a>16 Appendix: SSH Key for GitHub</h1>
<p><em>What triggers the Daily Build at NuttX Mirror Repo?</em></p>
<p>Our script <a href="https://github.com/lupyuen/nuttx-release/blob/main/sync-build-ingest.sh"><em>sync-build-ingest.sh</em></a> will trigger the <strong>Daily Build</strong>, followed by the ingestion of the GitHub Actions Logs.</p>
<p>Inside the script: Our Regular GitHub Account <em>nuttxpr</em> will start the build by pushing a patch to the NuttX Mirror Repo (pic above). This is how we create an SSH Key for GitHub that will allow <em>nuttxpr</em> to push the patch‚Ä¶</p>
<p>(<em>nuttxpr</em> is an Ordinary GitHub Account with Read Access. Don‚Äôt use a GitHub Admin Account!)</p>
<ol>
<li>
<p>Inside our VM: Create the <strong>GitHub SSH Key</strong></p>
<div class="example-wrap"><pre class="language-bash"><code>## From https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent
ssh-keygen \
  -t ed25519 \
  -f $HOME/.ssh/nuttxpr@github \
  -C &quot;nuttxpr@github&quot;</code></pre></div></li>
<li>
<p>Add the SSH Key to GitHub Account</p>
<p><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account"><strong>Follow the steps here</strong></a></p>
<p>Copy from our Public Key at <em>$HOME/.ssh/nuttxpr@github.pub</em>, paste into GitHub</p>
</li>
<li>
<p>Test the SSH Key</p>
<div class="example-wrap"><pre class="language-bash"><code>ssh -T \
  -i $HOME/.ssh/nuttxpr@github \
  git@github.com

## We should see...
## Hi nuttxpr! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code></pre></div></li>
<li>
<p>Add the SSH Key to our SSH Config. Edit <em>$HOME/.ssh/config</em></p>
<div class="example-wrap"><pre class="language-bash"><code>nano $HOME/.ssh/config</code></pre></div>
<p>Add this‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>Host github.com
  IdentityFile ~/.ssh/nuttxpr@github</code></pre></div></li>
<li>
<p>Test our updated SSH Config</p>
<div class="example-wrap"><pre class="language-bash"><code>## Should now work without stating Private Key
ssh -T \
  git@github.com

## We should see...
## Hi nuttxpr! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code></pre></div></li>
</ol>
<h1 id="appendix-ssh-key-for-vm-login"><a class="doc-anchor" href="#appendix-ssh-key-for-vm-login">¬ß</a>17 Appendix: SSH Key for VM Login</h1>
<p>Connecting to our VM gets tedious. Let‚Äôs create an <strong>SSH Key for VM Login</strong>‚Ä¶</p>
<ol>
<li>
<p>Create the SSH Key on <strong>Our Computer</strong> (NOT the VM)</p>
<div class="example-wrap"><pre class="language-bash"><code>## From https://docs.cloud.google.com/compute/docs/connect/create-ssh-keys
## Do this on our computer, NOT the VM!
## Change &quot;luppy&quot; to your VM Username
ssh-keygen \
  -t rsa \
  -f $HOME/.ssh/nuttx-dashboard-vm \
  -C luppy

## Check the output
ls $HOME/.ssh/nuttx-dashboard-vm*

## We should see...
## nuttx-dashboard-vm
## nuttx-dashboard-vm.pub</code></pre></div></li>
<li>
<p>Add the SSH Public Key to our VM‚Ä¶</p>
<p><a href="https://docs.cloud.google.com/compute/docs/connect/add-ssh-keys?cloudshell=false#metadata"><strong>Follow the steps here</strong></a></p>
<p>Browse to <strong>‚ÄúGoogle Cloud Console &gt; Metadata‚Äù</strong></p>
<div class="example-wrap"><pre class="language-bash"><code>https://console.cloud.google.com/compute/metadata</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ssh1.png" alt="Google Cloud Console &gt; Metadata" /></p>
<p>Click <strong>‚ÄúSSH Keys &gt; Add SSH Key‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-ssh2.png" alt="SSH Keys &gt; Add SSH Key" /></p>
<p>Copy and paste the contents of our Public Key: <em>$HOME/.ssh/nuttx-dashboard-vm.pub</em></p>
<p><img src="https://lupyuen.org/images/dashboard-ssh3.png" alt="Copy and paste the Public Key" /></p>
<p>Click <strong>‚ÄúSave‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-ssh4.png" alt="Save the SSH Key" /></p>
</li>
<li>
<p>Test the SSH Key with VM Login</p>
<div class="example-wrap"><pre class="language-bash"><code>## From https://docs.cloud.google.com/compute/docs/connect/standard-ssh#openssh-client
## Change &quot;luppy&quot; to your VM Username
ssh \
  -i $HOME/.ssh/nuttx-dashboard-vm \
  luppy@x.x.x.x</code></pre></div></li>
</ol>
<h1 id="appendix-remote-connect-in-vscode"><a class="doc-anchor" href="#appendix-remote-connect-in-vscode">¬ß</a>18 Appendix: Remote Connect in VSCode</h1>
<p><em>Is there an easier way to work with our VM?</em></p>
<p>Yep use a <strong>SSH Remote Connection in VSCode</strong>!</p>
<ol>
<li>
<p>Assume that we have added an SSH Key for VM Login‚Ä¶</p>
<p><a href="https://lupyuen.org/articles/dashboard#appendix-ssh-key-for-vm-login"><strong>‚ÄúSSH Key for VM Login‚Äù</strong></a></p>
</li>
<li>
<p>In VSCode: Click <strong>‚ÄúRemote Explorer &gt; SSH &gt; +‚Äù</strong></p>
<p>Enter the SSH Command‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>ssh -i ~/.ssh/nuttx-dashboard-vm luppy@x.x.x.x </code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ssh6.png" alt="SSH Command" /></p>
</li>
<li>
<p>Select the SSH Config file <em>$HOME/.ssh/config</em></p>
<p>Click <strong>‚ÄúConnect‚Äù</strong></p>
<p>To open a Remote File or Remote Folder: Click <strong>‚ÄúFile &gt; Open File / Folder‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-ssh7.png" alt="File &gt; Open File / Folder" /></p>
</li>
</ol>
<p><em>$HOME/.ssh/config</em> will look like:</p>
<div class="example-wrap"><pre class="language-bash"><code>Host x.x.x.x
  HostName x.x.x.x
  IdentityFile ~/.ssh/nuttx-dashboard-vm
  User luppy</code></pre></div>
<p>Probably better to rename the ‚ÄúHost‚Äù, in case the IP Address changes‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>Host nuttx-dashboard-vm
  HostName x.x.x.x
  IdentityFile ~/.ssh/nuttx-dashboard-vm
  User luppy</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-ssh8.png" alt="Should rename the Host" /></p>
<p><strong>Port Forwarding over SSH</strong> works great with VSCode. Thus we can redirect the TCP Ports from the VM to Our Computer. And disable all the Firewall Rules!</p>
<p><img src="https://lupyuen.org/images/dashboard-ssh9.png" alt="Port Forwarding over SSH works great with VSCode" /></p>
<h1 id="appendix-expand-the-vm-disk"><a class="doc-anchor" href="#appendix-expand-the-vm-disk">¬ß</a>19 Appendix: Expand the VM Disk</h1>
<p>By Default: Google Cloud allocates <strong>10 GB of Disk Space</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>$ df -H
Filesystem      Size  Used Avail Use% Mounted on
udev            2.1G     0  2.1G   0% /dev
tmpfs           412M  574k  411M   1% /run
/dev/sda1        11G  8.5G  1.4G  87% /
tmpfs           2.1G     0  2.1G   0% /dev/shm
tmpfs           5.3M     0  5.3M   0% /run/lock
/dev/sda15      130M   13M  118M  10% /boot/efi
tmpfs           412M     0  412M   0% /run/user/1000</code></pre></div>
<p>But <em>/tmp</em> and <em>/dev/sda1</em> will <strong>Run Out of Disk Space</strong> while ingesting NuttX Build Logs‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## Out of space in /tmp
$ df -H
Filesystem      Size  Used Avail Use% Mounted on
udev            2.1G     0  2.1G   0% /dev
tmpfs           412M  574k  411M   1% /run
/dev/sda1        11G  9.8G     0 100% /
tmpfs           2.1G     0  2.1G   0% /dev/shm
tmpfs           5.3M     0  5.3M   0% /run/lock
/dev/sda15      130M   13M  118M  10% /boot/efi
tmpfs           412M     0  412M   0% /run/user/1000

## Most of the disk space used by /tmp
$ rm -rf /tmp/sync-build-ingest/</code></pre></div>
<p>This is how we <a href="https://dev.to/lovestaco/expanding-disk-size-in-google-cloud-5gkh"><strong>Expand the VM Disk</strong></a>, from 10 GB to 20 GB‚Ä¶</p>
<ol>
<li>
<p>Click <strong>‚ÄúVM &gt; Details &gt; Storage &gt; Boot Disk‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-disk1.png" alt="VM &gt; Details &gt; Storage &gt; Boot Disk" /></p>
</li>
<li>
<p>Click <strong>‚ÄúMenu &gt; Edit‚Äù</strong> (Top Right)</p>
<p><img src="https://lupyuen.org/images/dashboard-disk2.png" alt="Menu &gt; Edit" /></p>
</li>
<li>
<p>Increase the size from 10 GB to 20 GB. Click <strong>Save</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-disk3.png" alt="Increase the size from 10 GB to 20 GB" /></p>
</li>
<li>
<p>Inside our VM: Do this‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>sudo apt install fdisk
sudo fdisk -l

## We should see
## Device      Start      End  Sectors  Size Type
## /dev/sda1  262144 20969471 20707328  9.9G Linux root (x86-64)
## /dev/sda14   2048     8191     6144    3M BIOS boot
## /dev/sda15   8192   262143   253952  124M EFI System

## Let&#39;s expand /dev/sda to 20 GB
sudo fdisk /dev/sda

## Ignore the warning
## Enter: w

## Resize partition 1 (/dev/sda1), which maps to /
sudo apt install cloud-guest-utils
sudo growpart /dev/sda 1

## We should see...
## CHANGED: partition=1 start=262144 old: size=20707328 end=20969471 new: size=41680863 end=41943006

## Resize the Filesystem
sudo resize2fs /dev/sda1

## We should see...
## Filesystem at /dev/sda1 is mounted on /; on-line resizing required
## old_desc_blocks = 2, new_desc_blocks = 3
## The filesystem on /dev/sda1 is now 5210107 (4k) blocks long.

## sda1 is bigger now
$ sudo fdisk -l
Device      Start      End  Sectors  Size Type
/dev/sda1  262144 41943006 41680863 19.9G Linux root (x86-64)
/dev/sda14   2048     8191     6144    3M BIOS boot
/dev/sda15   8192   262143   253952  124M EFI System

## More space in /tmp yay!
$ df -H
Filesystem      Size  Used Avail Use% Mounted on
udev            2.1G     0  2.1G   0% /dev
tmpfs           412M  574k  411M   1% /run
/dev/sda1        21G  8.5G   12G  43% /
tmpfs           2.1G     0  2.1G   0% /dev/shm
tmpfs           5.3M     0  5.3M   0% /run/lock
/dev/sda15      130M   13M  118M  10% /boot/efi
tmpfs           412M     0  412M   0% /run/user/1000</code></pre></div></li>
</ol>
<h1 id="appendix-publish-online-with-cloudflare"><a class="doc-anchor" href="#appendix-publish-online-with-cloudflare">¬ß</a>20 Appendix: Publish Online with Cloudflare</h1>
<p><em>Our VM is running. How do we actually publish it at a Web URL?</em></p>
<p>Here are two ways‚Ä¶</p>
<ul>
<li>
<p>Option One: We publish it with a <strong>Cloudflare Tunnel</strong></p>
</li>
<li>
<p>Option Two: We publish to <strong>Any CDN</strong></p>
</li>
</ul>
<p><strong>Option One: Cloudflare Tunnel</strong></p>
<ol>
<li>
<p>We create a Cloudflare Tunnel, pointing to‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://localhost:3000</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare2.png" alt="Cloudflare Tunnel" /></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare1.png" alt="Cloudflare Tunnel" /></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare3.png" alt="Cloudflare Tunnel" /></p>
</li>
<li>
<p>Remember to set the cache‚Ä¶</p>
<p>Set <strong>‚ÄúCache URI Path &gt; Wildcard &gt; Value‚Äù</strong> to‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>/public/*</code></pre></div>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare12.png" alt="Cloudflare Cache" /></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare13.png" alt="Cloudflare Cache" /></p>
</li>
</ol>
<p><strong>Option Two: Cloudflare CDN</strong></p>
<ol>
<li>
<p>Remember that Grafana listens at <strong>Port 3000</strong>? We configure <strong>iptables</strong> to route incoming packets from <strong>Port 80 to Port 3000</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## https://askubuntu.com/questions/444729/redirect-port-80-to-8080-and-make-it-work-on-local-machine

$ sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3000

$ sudo iptables -t nat -L -n -v

Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
pkts bytes target     prot opt in     out     source               destination         
    0     0 REDIRECT   6    --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 redir ports 3000

## To delete the rule:
## sudo iptables -t nat -D PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3000</code></pre></div></li>
<li>
<p>Configure our <strong>VM Firewall</strong> to allow HTTP traffic‚Ä¶</p>
<p>Click <strong>‚ÄúVM &gt; Edit &gt; Dynamic Network Interfaces &gt; Allow HTTP traffic‚Äù</strong></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare9.png" alt="VM &gt; Edit &gt; Dynamic Network Interfaces &gt; Allow HTTP traffic" /></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare8.png" alt="VM &gt; Edit &gt; Dynamic Network Interfaces &gt; Allow HTTP traffic" /></p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare10.png" alt="VM &gt; Edit &gt; Dynamic Network Interfaces &gt; Allow HTTP traffic" /></p>
</li>
<li>
<p>Why does this work? That‚Äôs because there‚Äôs a Default Firewall Rule <strong>‚Äúdefault-allow-http‚Äù</strong> that will allow incoming TCP Port 80, whenever the Target Tag matches <strong>‚Äúhttp-server‚Äù</strong>‚Ä¶</p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare11.png" alt="Default Firewall Rule ‚Äúdefault-allow-http‚Äù allows incoming TCP Port 80, whenever the Target Tag matches ‚Äúhttp-server‚Äù" /></p>
</li>
<li>
<p>Check that our <strong>External IP Address</strong> is now accessible via HTTP Port 80‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>http://x.x.x.x</code></pre></div></li>
<li>
<p>Under Cloudflare DNS: Create an <strong>‚ÄúA Record‚Äù</strong> that points to our External IP Address.</p>
<p>Remember to <strong>Enable the HTTP Proxy</strong>.</p>
<p>(Actually we should get a <strong>Static IP Address</strong> for our VM)</p>
<p><img src="https://lupyuen.org/images/dashboard-cloudflare4.png" alt="Create the ‚ÄúA Record‚Äù for DNS" /></p>
</li>
<li>
<p>And our NuttX Dashboard is live on the web!</p>
</li>
</ol>
<p><img src="https://lupyuen.org/images/dashboard-title.jpg" alt="Grafana Dashboard on Google Cloud VM for Apache NuttX RTOS" /></p>

    
    <!-- Begin scripts/rustdoc-after.html: Post-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker and Prism Theme -->
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker and Prism Theme -->

    <!-- End scripts/rustdoc-after.html -->
    

</body>
</html>