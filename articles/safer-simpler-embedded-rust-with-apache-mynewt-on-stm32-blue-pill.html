<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill</title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
  <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
  <meta data-rh="true" property="al:ios:app_name" content="Medium" />
  <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
  <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
  <meta data-rh="true" property="fb:app_id" content="542599432471018" />
  <meta data-rh="true" property="og:site_name" content="Medium" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-08-17T17:16:02.949Z" />
  <meta data-rh="true" name="title" content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" property="og:title"
    content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" property="twitter:title"
    content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" name="twitter:site" content="@Medium" />
  <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:android:url" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:ios:url" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:android:app_name" content="Medium" />
  <meta data-rh="true" name="description"
    content=" Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders from stumbling into embedded traps What‚Äôs great about Apache Mynewt? Today Mynewt‚Ä¶" />
  <meta data-rh="true" property="og:description"
    content="Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders" />
  <meta data-rh="true" property="twitter:description"
    content="Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders" />
  <meta data-rh="true" property="og:url"
    content="https://web.archive.org/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac" />
  <meta data-rh="true" property="al:web:url"
    content="https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac" />
  <meta data-rh="true" property="og:image"
    content="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/1200/1*rx5uTlvZn3RWW_MOgEtd_w.png" />
  <meta data-rh="true" name="twitter:image:src"
    content="https://miro.medium.com/max/1200/1*rx5uTlvZn3RWW_MOgEtd_w.png" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee ÊùéÁ´ãÊ∫ê" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="18 min read" />

<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">

<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->

</head>

<body>
  <div id="root">
    <div class="a b c">
      <article>
        <section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span>
        <div>
          <div class="cp u cq cr cs ct"></div>
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="da cz ak paragraph-image">
                
                
                <p><img src="https://lupyuen.github.io/images/legacy2/d1.png" /></p>



                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Article Roadmap: From JSON parsing to bindgen to
                  Declarative and Procedural Macros and how to debug them</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <div>
                  <div id="cf95" class="ea eb ec bk ed b ee ef eg eh ei ej ek">
                    <h1 class="ed b ee el ec">Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill</h1>
                  </div>
                  <div class="em">
                    <div class="n en eo ep eq">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="/web/20191204194043/https://medium.com/@ly.lee?source=post_page-----d8fcb41969ac----------------------">
                            <div class="dd er es">
                              <div class="bs n et o p cp eu ev ew ex ey ct"></div><img alt="Lup Yuen Lee ÊùéÁ´ãÊ∫ê" class="r ez es er"
                                src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                                width="48" height="48" />
                            </div>
                          </a></div>
                        <div class="fa ak r">
                          <div class="n">
                            <div style="flex:1"><span class="bj b bk bl bm bn r ec q">
                                <div class="fb n o fc"><span class="bj dy ds bl di fd fe ff fg fh ec"><a
                                      class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener"
                                      href="/web/20191204194043/https://medium.com/@ly.lee?source=post_page-----d8fcb41969ac----------------------">Lup
                                      Yuen Lee ÊùéÁ´ãÊ∫ê</a></span>
                                  <div class="fj r ar h"><button
                                      class="fk ec q by fl fm fn fo bc bh fp fq fr fs ft fu cb bj b bk fv fw bn cc cd ce cf cg bf">Follow</button>
                                  </div>
                                </div>
                              </span></div>
                          </div><span class="bj b bk bl bm bn r bo bp"><span class="bj dy ds bl di fd fe ff fg fh bo">
                              <div><a class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener"
                                  href="/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=post_page-----d8fcb41969ac----------------------">Jul
                                  6</a> <!-- -->¬∑
                                <!-- -->
                                <!-- -->18
                                <!-- --> min read
                              </div>
                            </span></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="5422" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Declarative and
                    Procedural Macros (plus </em><code class="dm gw gx gy gz b"><em class="gv">bindgen</em></code><em
                    class="gv"> and tips for Visual Studio Code) to protect Embedded Rust coders from stumbling into
                    embedded traps</em></p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d2.png" /></p>

          
                </figure>
                <blockquote class="hh hi hj">
                  <p id="c2f6" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">I‚Äôm named <strong
                      class="gj hk">MyNewt</strong> not <strong class="gj hk">Mynewt</strong> because my handler is a
                    crazy coder named Lup and this lizard doesn‚Äôt speak on behalf of the wonderful <a
                      href="https://mynewt.apache.org/latest/index.html"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Apache Mynewt</a> team</p>
                </blockquote>
                <p id="996d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What‚Äôs great about <a
                    href="https://mynewt.apache.org/latest/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Apache
                      Mynewt</strong></a>? Today Mynewt runs on <a
                    href="https://mynewt.apache.org/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">many microcontroller platforms</a>
                  with <a
                    href="https://mynewt.apache.org/latest/os/core_os/mynewt_os.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">preemptive multitasking</a>. (So
                  it won‚Äôt choke when <a class="at cg hl hm hn ho" target="_blank" rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/build-your-iot-sensor-network-stm32-blue-pill-nrf24l01-esp8266-apache-mynewt-thethings-io-ca7486523f5d">reading
                    sensors and transmitting data simultaneously</a>.)</p>
                <p id="be21" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Mynewt has drivers for many
                  sensors (like <a
                    href="https://github.com/apache/mynewt-core/tree/master/hw/drivers/sensors/bme280"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">BME280</a>), networks (<a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/master/libs/esp8266"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">ESP8266</a>, <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/master/libs/nrf24l01"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">nRF24L01</a>, ‚Ä¶) and protocols (<a
                    href="https://en.wikipedia.org/wiki/Constrained_Application_Protocol"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">CoAP</a>, <a
                    href="https://en.wikipedia.org/wiki/CBOR"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">CBOR</a>, ‚Ä¶).</p>
                <p id="9636" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But Mynewt was <strong
                    class="gj hk">built with C</strong>, which has its problems‚Ä¶</p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d3.png" /></p>

         
                </figure>
                <blockquote class="hh hi hj">
                  <p id="b02e" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">The C code appeared in an <a
                      class="at cg hl hm hn ho" target="_blank" rel="noopener"
                      href="/web/20191204194043/https://medium.com/@ly.lee/build-your-iot-sensor-network-stm32-blue-pill-nrf24l01-esp8266-apache-mynewt-thethings-io-ca7486523f5d">earlier
                      article</a> about Mynewt on STM32 Blue Pill</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d4.png" /></p>

             
                </figure>
                <blockquote class="hh hi hj">
                  <p id="9726" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/send_coap.rs#L319-L376"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">The new Rust code is here</a>.
                    Based on the previous article on Rust and Mynewt‚Ä¶</p>
                </blockquote>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Hosting Embedded Rust apps on Apache Mynewt with STM32 Blue
                            Pill</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Build IoT devices the smarter, safer way with Rust and Apache
                              Mynewt</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="jh r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="db6f" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Declarative Macros in Rust</h1>
                <p id="6669" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu"><a
                    href="https://doc.rust-lang.org/book/ch19-06-macros.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Declarative Macros in Rust</a>
                  have the form <code class="dm gw gx gy gz b">( pattern ) =&gt; { substitution }</code></p>
                <p id="2a48" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here‚Äôs a simple Declarative Macro
                  <code class="dm gw gx gy gz b">add_88!()</code> that returns its argument plus 88‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/32af6445eb258339fe2363b770b7d099.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L14"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L14</a>
                  </figcaption>
                </figure>
                <p id="ff99" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Rust macro accepts a single
                  parameter <code class="dm gw gx gy gz b">$e</code>, which should be a valid Rust Expression (denoted
                  by <code class="dm gw gx gy gz b">expr</code>). In C we would code the macro as‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="10e1" class="kk jp ec bk gz b ds kl km r kn">#define  add_88(e)  ((e) + 88)</span></pre>
                <p id="0c7f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Rust and C macro definitions
                  are similar, except that Rust insists on knowing whether the parameter will be an expression (<code
                    class="dm gw gx gy gz b">expr</code>), identifier (<code class="dm gw gx gy gz b">ident</code>),
                  type (<code class="dm gw gx gy gz b">ty</code>), statement (<code
                    class="dm gw gx gy gz b">stmt</code>), code block (<code class="dm gw gx gy gz b">block</code>)‚Ä¶ (<a
                    href="https://danielkeep.github.io/tlborm/book/mbe-macro-rules.html#captures"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Here‚Äôs the whole list</a>)</p>
                <p id="0b0d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We may provide multiple patterns
                  like this to create an ‚Äúoverloaded function‚Äù‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
             
                  <p><script src="https://gist.github.com/lupyuen/321477fd84b6e1fd0a52dea2c8253fe6.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L25"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L25</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="315a" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Complex Pattern Matching in
                  Declarative Macros</h1>
                <p id="4fe8" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">But wait‚Ä¶ Rust macros can do so
                  much more because of pattern matching! Here‚Äôs a tiny snippet from a Rust macro that parses JSON code
                  (adapted from the <code
                    class="dm gw gx gy gz b"><a href="https://crates.io/crates/serde_json" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">serde_json</a></code>
                  library)‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                  
                  <p><script src="https://gist.github.com/lupyuen/ef92789353dc883c4da72f950e577fb4.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy"><a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L105-L120"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L105-L120</a>
                  </figcaption>
                </figure>
                <p id="5ddc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The pattern looks complicated‚Ä¶
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d556" class="kk jp ec bk gz b ds kl km r kn">(@$enc:ident <a href="http://twitter.com/object" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">@object</a> $obj:ident [$($key:tt)+] ($value:expr) , $($rest:tt)*)</span></pre>
                <p id="a883" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code
                    class="dm gw gx gy gz b">parse!()</code> macro is meant to be called with these parameters‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f437" class="kk jp ec bk gz b ds kl km r kn">parse!( @json @object context [&quot;device&quot;] (&quot;010203&quot;) , (omitted) )</span></pre>
                <p id="ecd2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Which is an intermediate step
                  that‚Äôs called when encoding our CoAP message in JSON: <code
                    class="dm gw gx gy gz b">coap!(@json { ‚Äúdevice‚Äù: ‚Äú010203‚Äù, ‚Ä¶ })</code></p>
                <p id="4409" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro parameters are matched
                  against the pattern like this‚Ä¶</p>
              </div>
            </div>
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy2/d5.png" /></p>

              
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Matching the parse!() macro parameters with the
                  macro pattern</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="a9f0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What‚Äôs a <strong
                    class="gj hk">Tag</strong>? Think of a Tag as an <code class="dm gw gx gy gz b">enum</code> ‚Äî an
                  option that specifies how the macro should behave. For the first parameter of the macro we accept the
                  tag <code class="dm gw gx gy gz b">‚Äú@json‚Äù</code> to indicate that the macro should encode sensor data
                  in JSON format, or <code class="dm gw gx gy gz b">‚Äú@cbor‚Äù</code> for CBOR format. Tags may be used to
                  implement <a
                    href="https://danielkeep.github.io/tlborm/book/pat-internal-rules.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">internal rules</a>.</p>
                <p id="e27d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What‚Äôs a <a
                    href="https://doc.rust-lang.org/reference/macros-by-example.html#metavariables"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Token
                      Tree</strong></a>? It‚Äôs one or more Rust tokens that are logically grouped. Here are three
                  examples of Token Trees: <code class="dm gw gx gy gz b">x</code>, <code
                    class="dm gw gx gy gz b">(x + y)</code>, <code
                    class="dm gw gx gy gz b">{ println!(&quot;hi&quot;); }</code>.</p>
                <p id="a905" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code
                    class="dm gw gx gy gz b">+</code> and <code class="dm gw gx gy gz b">*</code> operators should be
                  familiar if you have used Regular Expressions. So <code class="dm gw gx gy gz b">$($key:tt)+</code>
                  means the <code class="dm gw gx gy gz b">$key</code> placeholder will be matched to one or more Token
                  Trees (denoted by <code class="dm gw gx gy gz b">tt</code>).</p>
                <p id="8110" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">In the <a
                    href="https://gist.github.com/lupyuen/ef92789353dc883c4da72f950e577fb4"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">source code of the macro</a> there
                  are a couple of interesting things‚Ä¶</p>
                <p id="1041" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ <code
                    class="dm gw gx gy gz b">d!(‚Ä¶)</code> is a simple macro we created to dump the parameters of the
                  macro. Useful for debugging.</p>
                <p id="4f6d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ <code
                    class="dm gw gx gy gz b">coap_item_str!(‚Ä¶)</code> is a macro that will generate the JSON or CBOR
                  code for encoding the <code class="dm gw gx gy gz b">key: value</code> entry. The encoding format
                  depends on the first parameter.</p>
                <p id="8552" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3Ô∏è‚É£ The macro is recursive! Once
                  the rule has encoded the <code class="dm gw gx gy gz b">key: value</code> entry, it continues to
                  encode the rest of the input JSON (<code class="dm gw gx gy gz b">$rest</code>) by calling itself!</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="642e" class="kk jp ec bk gz b ds kl km r kn">parse!( @$enc @object $obj () ($($rest)*) ($($rest)*) )</span></pre>
                <p id="c6c8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That‚Äôs how our <code
                    class="dm gw gx gy gz b">coap!()</code> macro (<a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L47-L1253"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">complete source code here</a>)
                  recursively parses a JSON document and emits the CoAP encoding. Which makes Rust Declarative Macros
                  very powerful for parsing many types of code recursively. Even <a
                    href="https://doc.rust-lang.org/rust-by-example/macros/dsl.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Domain
                      Specific Languages</strong></a>! Check out the details in the <a
                    href="https://danielkeep.github.io/tlborm/book/README.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Little Book of Rust Macros</a>.
                </p>
                <blockquote class="hh hi hj">
                  <p id="3b31" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">ü§î</em> You may
                    think‚Ä¶ <strong class="gj hk">What‚Äôs the cost of embedding Rust code inside a C platform like
                      Mynewt?</strong> Do Rust macros inject a lot more code to make them run on a C platform?</p>
                  <p id="38eb" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">Not at all! <strong
                      class="gj hk">The macros are expanded at compile time</strong>. And the Rust compiler is
                    incredibly clever at pattern matching and type inference. So these macros will take up exactly the
                    same RAM, ROM and CPU resources as the older C code! While keeping the code clear and simple!</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="27e2" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Two Legged Problems</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d6.png" /></p>

                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d7.png" /></p>

                
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="e8c9" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Import C Functions into Rust
                  with bindgen</h1>
                <p id="35ee" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">We could import a C function into
                  Rust by coding the Rust binding manually (<a class="at cg hl hm hn ho" target="_blank" rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f">as
                    explained earlier</a>). But writing the Rust bindings by hand for the entire Mynewt API is way too
                  tedious.</p>
                <p id="53ad" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Fortunately we have the <code
                    class="dm gw gx gy gz b"><a href="https://rust-lang.github.io/rust-bindgen/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">bindgen</a></code>
                  tool: It reads a Mynewt C function declaration like this (<code
                    class="dm gw gx gy gz b"><a href="https://mynewt.apache.org/latest/os/core_os/task/task.html#c.os_task_init" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">os_task_init</a>()</code>
                  is the Mynewt function for creating background tasks)‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/2dbcecf3062522ef3c5e182b36a31713.js"></script></p>


                </figure>
                <p id="d8db" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">And produces the Rust binding
                  like this‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                  
                  <p><script src="https://gist.github.com/lupyuen/450476c651ca7bd65aa534508527e6cc.js"></script></p>


                </figure>
                <p id="83cd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We have a <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/scripts/gen-bindings.sh"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">script that generates Rust
                    bindings</a> for Mynewt Core API, Sensor API, JSON API and CBOR API.</p>
                <p id="881a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">There‚Äôs still manual tweaking
                  required‚Ä¶ In the script we see many whitelisted and blacklisted C functions and types. These were
                  carefully chosen to avoid duplicates across the different APIs.</p>
                <p id="c448" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Rust is self-documenting, so the
                  Rust bindings for Mynewt automatically have documentation. Check out the <strong class="gj hk">Mynewt
                    API Documentation for Rust</strong>‚Ä¶</p>
                <div class="ib ic id ie if ig"><a
                    href="https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/index.html?source=post_page-----d8fcb41969ac----------------------"
                    rel="noopener nofollow">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">mylib::mynewt - Rust</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">API documentation for the Rust `mynewt` mod in crate `mylib`.
                            </div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">lupyuen.github.io</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="kt r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
                <blockquote class="hh hi hj">
                  <p id="b217" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">üíé</em> Normally
                    <code class="dm gw gx gy gz b">bindgen</code> reads an entire C header file to generate Rust
                    bindings for all functions declared in the file. But Mynewt uses many include folders that will
                    totally confuse <code class="dm gw gx gy gz b">bindgen</code>.</p>
                  <p id="15c3" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">That‚Äôs why <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/scripts/gen-bindings.sh#L30-L42"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">the script passes the
                      options</a> <code class="dm gw gx gy gz b">-CC -E -dD</code> to <code
                      class="dm gw gx gy gz b">gcc</code> to create a C file that has all the include files (for that
                    specific API) concatenated into one long source file. Which works great with <code
                      class="dm gw gx gy gz b">bindgen</code>!</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="2344" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">The Restless bindgen Horde</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d8.png" /></p>

       
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d9.png" /></p>

               
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d10.png" /></p>

               
                </figure>
                <p id="f0b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Creating the safe wrapper in Rust
                  doesn‚Äôt need a lot of manual coding‚Ä¶ <strong class="gj hk">Procedural Macros</strong> in Rust can do
                  the job for us automatically! First let‚Äôs understand what a Procedural Macro can do‚Ä¶</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="74c0" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Create a Procedural Macro with
                  syn</h1>
                <p id="3942" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Here‚Äôs a simple Procedural Macro
                  named <code class="dm gw gx gy gz b">out!()</code> (shown in the pic above) that expands‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d7f6" class="kk jp ec bk gz b ds kl km r kn">out!( NETWORK_TASK )</span></pre>
                <p id="b0a1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">into‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="c48c" class="kk jp ec bk gz b ds kl km r kn">unsafe { &amp;mut NETWORK_TASK }</span></pre>
                <p id="ee82" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">‚Ä¶because to a C coder starting
                  Rust coding, <code class="dm gw gx gy gz b">unsafe &amp;mut</code> looks doubly intimidating, so we
                  use a macro to declare that <code class="dm gw gx gy gz b">NETWORK_TASK</code> will be modified by the
                  external function, like this: <code class="dm gw gx gy gz b">out!(NETWORK_TASK)</code></p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/500da7dd734d7dd9edfd1985675ea110.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L279-L292"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L279-L292</a>
                  </figcaption>
                </figure>
                <p id="505b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Unlike Declarative Macros,
                  Procedural Macros are coded like a real Rust function. A Procedural Macro simply transforms a stream
                  of Rust source code tokens (<code class="dm gw gx gy gz b">TokenStream</code>) into the expanded
                  tokens, that will be fed back into the Rust compiler after expanding the macro.</p>
                <p id="806e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">parse_macro_input!()</code> is provided by the <code
                    class="dm gw gx gy gz b"><a href="https://docs.rs/syn/0.15.38/syn/index.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">syn</a></code><a
                    href="https://docs.rs/syn/0.15.38/syn/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> library</a> for parsing streams
                  of Rust source code tokens. We can parse any Rust code with it: Expressions, Statement Blocks, <code
                    class="dm gw gx gy gz b">Struct</code> Definitions, <code class="dm gw gx gy gz b">Extern</code>
                  Declarations, ‚Ä¶ Here we are parsing the input as a Rust Identifier, like a variable or constant name.
                </p>
                <p id="3fb8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We use <code
                    class="dm gw gx gy gz b">format!()</code> to create the desired code. Then we parse the code into a
                  <code class="dm gw gx gy gz b">TokenStream</code> and pass it back to the compiler.</p>
                <figure class="hb hc hd he hf cz">
            
                  <p><script src="https://gist.github.com/lupyuen/891a0a0e64d335a3ec33592de4378f06.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy"><a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L293-L306"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L293-L306</a>
                  </figcaption>
                </figure>
                <p id="a831" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This <code
                    class="dm gw gx gy gz b">strn!()</code> macro is similar‚Ä¶ It expands</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="bca3" class="kk jp ec bk gz b ds kl km r kn">strn!( &quot;network&quot; )</span></pre>
                <p id="9f38" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">into‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="7823" class="kk jp ec bk gz b ds kl km r kn">&amp;Strn::new( b&quot;network\0&quot; )</span></pre>
                <p id="7084" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro code looks similar,
                  except that it parses the input as a Literal String (<code class="dm gw gx gy gz b">LitStr</code>)
                  instead of an Identifier. (And the expansion is different of course.) Why did we create <code
                    class="dm gw gx gy gz b">strn!()</code>?</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="9805" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">C vs Rust Strings: Null vs
                  Non-Null Terminated</h1>
                <p id="9aef" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">In the world of Embedded C,
                  strings are simple fixed arrays of ASCII bytes, terminated by a null <code
                    class="dm gw gx gy gz b">00</code> byte. Rust strings are more complicated ‚Äî A Rust string is a <a
                    href="https://doc.rust-lang.org/src/alloc/string.rs.html#283-285"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Vector of bytes</a>. A <a
                    href="https://doc.rust-lang.org/std/vec/struct.Vec.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Vector</a> is resizable, so
                  the vector uses an internal counter to remember its length. <strong class="gj hk">Strings in Rust are
                    not terminated by the null byte.</strong></p>
                <p id="073d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This causes problems when
                  Embedded Rust coders call Mynewt APIs, drivers and other C functions‚Ä¶ 1Ô∏è‚É£ They may use Rust strings as
                  though they were C strings, <strong class="gj hk">omitting the terminating null byte</strong> (and
                  causing the C code to crash) 2Ô∏è‚É£ Or they may create many <strong class="gj hk">temporary Rust
                    strings</strong> while appending the null byte before calling the C functions.</p>
                <p id="6303" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The solution we have chosen is a
                  simplistic one ‚Äî We create a new type <code class="dm gw gx gy gz b">Strn</code> that represents a
                  <strong class="gj hk">null-terminated string that will never be modified</strong>. It contains a fixed
                  slice (array) of bytes that always ends with null. <code class="dm gw gx gy gz b">Strn</code> verifies
                  this when setting and getting the string.</p>
                <figure class="hb hc hd he hf cz dr kv cd kw kx ky kz la ba lb lc ld le lf lg">
                 
                  <p><script src="https://gist.github.com/lupyuen/0332e48554c2f98a2137285015b2d761.js"></script></p>


                </figure>
                <p id="13ed" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The wrappers for Mynewt APIs only
                  accept <code class="dm gw gx gy gz b">Strn</code> for incoming strings, instead of the default <code
                    class="dm gw gx gy gz b">*const char</code>.</p>
                <p id="866f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How do we create an <code
                    class="dm gw gx gy gz b">Strn</code>? By calling the <code class="dm gw gx gy gz b">strn!()</code>
                  macro we just seen‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="ab5b" class="kk jp ec bk gz b ds kl km r kn">strn!( &quot;network&quot; )</span></pre>
                <p id="4525" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Which expands into‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="e4ab" class="kk jp ec bk gz b ds kl km r kn">&amp;Strn::new( b&quot;network\0&quot; )</span></pre>
                <p id="93db" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This creates an <code
                    class="dm gw gx gy gz b">Strn</code> from the <a
                    href="https://doc.rust-lang.org/reference/tokens.html#byte-string-literals"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Byte String</a> <code
                    class="dm gw gx gy gz b">b&quot;network\0&quot;</code>. C strings behave more like Rust Byte
                  Strings, but unfortunately Byte Strings are harder to manipulate without a helper like <code
                    class="dm gw gx gy gz b">Strn</code>.</p>
                <p id="3664" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">No more missing terminating
                  nulls‚Ä¶ No more temporary copies of strings just for adding nulls‚Ä¶ We have made Mynewt APIs safer,
                  simpler and <strong class="gj hk">more efficient</strong> for Rust!</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="798e" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Compose a Procedural Macro with
                  quote!{}</h1>
                <p id="7984" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Checking result codes returned by
                  C functions can be very tedious and we forget to check them sometimes. Let‚Äôs look at this macro <code
                    class="dm gw gx gy gz b">run!()</code> that was used in our sample code to transform a bunch of C
                  function calls (for encoding CoAP CBOR messages)‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/a5fae5ccb212acb1299697fd0e3eea63.js"></script></p>


                </figure>
                <p id="ce29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">‚Ä¶into this code with proper error
                  checking, via <code class="dm gw gx gy gz b">check_result()</code>‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
       
                  <p><script src="https://gist.github.com/lupyuen/37f368a9fce66dfc6ad27aab89782e01.js"></script></p>


                </figure>
                <p id="8ad7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How should we generate the
                  expanded code in the <code class="dm gw gx gy gz b">run!()</code> macro? We could have used the <code
                    class="dm gw gx gy gz b">format!()</code> method shown earlier‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
            
                  <p><script src="https://gist.github.com/lupyuen/1c7d6e0c96603dec358d747fceb01f2a.js"></script></p>


                </figure>
                <p id="4ded" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But for generating a block of
                  code, calling the <code class="dm gw gx gy gz b">quote!{}</code> macro (from the <code
                    class="dm gw gx gy gz b"><a href="https://docs.rs/quote/0.6.12/quote/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote</a></code><a
                    href="https://docs.rs/quote/0.6.12/quote/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> library</a>) looks cleaner‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/5c12260327f91e03223522c80c786e32.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L395-L402"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L395-L402</a>
                  </figcaption>
                </figure>
                <p id="70f4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that we use <code
                    class="dm gw gx gy gz b">#stmts</code> as a placeholder to tell the macro to substitute the value of
                  <code class="dm gw gx gy gz b">stmts</code> into actual expanded tokens.</p>
                <p id="2f21" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We also used <code
                    class="dm gw gx gy gz b">quote!{}</code> in our macro like this‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/31c698537437d781441fa64b3dc09d7c.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L371-L377"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L371-L377</a>
                  </figcaption>
                </figure>
                <p id="dac1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">quote!{}</code> is used here like a template, injecting <code
                    class="dm gw gx gy gz b">stmt_tokens</code> into a chunk of Rust code. Super useful for generating
                  Rust code‚Ä¶ in a Rust program!</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="66c9" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Match Code Patterns with syn
                </h1>
                <p id="d4bd" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Procedural Macros are more
                  powerful than Declarative Macros because they can analyse the source code tokens (with the <code
                    class="dm gw gx gy gz b">syn</code> library) and expand them differently depending on the context.
                </p>
                <p id="3ec6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Our <code
                    class="dm gw gx gy gz b">run!()</code> macro is picky ‚Äî it only watches out for calls to functions
                  named <code class="dm gw gx gy gz b">cbor_encode_...</code>. And it wraps the call with an error
                  handler (and inserts the namespace <code class="dm gw gx gy gz b">tinycbor</code>): <br /><code
                    class="dm gw gx gy gz b">let res = tinycbor::cbor_encode_...</code></p>
                <p id="5d29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It doesn‚Äôt disturb other
                  statements like <code class="dm gw gx gy gz b">let encoder = ...</code> because wrapping this with an
                  error handler would be so wrong. So our macro needs to‚Ä¶</p>
                <p id="9853" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ Match a Statement‚Ä¶</p>
                <p id="566d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ That contains a Function
                  Call‚Ä¶</p>
                <p id="78d6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3Ô∏è‚É£ That looks like <code
                    class="dm gw gx gy gz b">cbor_encode_...</code></p>
                <p id="dbbd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That‚Äôs easy to do with the <code
                    class="dm gw gx gy gz b">syn</code> parser and Rust pattern matching‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/611e83b8fa4389d56a465e43b44a1564.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L358-L371"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L358-L371</a>
                  </figcaption>
                </figure>
                <p id="3d1b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Rust has incredibly powerful
                  <code class="dm gw gx gy gz b">enums</code> that will let us match against patterns like <code
                    class="dm gw gx gy gz b">Semi(expr, ...)</code> and <code
                    class="dm gw gx gy gz b">Call(expr)</code>. This works really well with the <code
                    class="dm gw gx gy gz b">syn</code> parser for creating powerful source code transformations.</p>
                <p id="8b8a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The complete <code
                    class="dm gw gx gy gz b">run</code> macro with calls to <code class="dm gw gx gy gz b">syn</code>
                  and <code class="dm gw gx gy gz b">quote</code> is shown below. Although the <code
                    class="dm gw gx gy gz b">run</code> macro is meant for calling Embedded C functions, the macro
                  applies a layer of error checking on top of the function calls, in a way that feels natural to the
                  Rust coder. Safer coding, made possible with Rust‚Äôs Procedural Macros!</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/cd673b0355e82e1279c8c97b54c80986.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L326-L404"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L326-L404</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy2/d11.png" /></p>

              
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Evolving the #[safe_wrap] macro</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="84d3" class="jo jp ec bk bj jc jq li js lj ju lk jw ll jy lm ka">Put Everything Together:
                  #[safe_wrap] macro</h1>
                <p id="89bd" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Remember the <strong
                    class="gj hk">Safe Wrapper for Mynewt Functions</strong>? Now we can explain how the wrapper was
                  constructed automatically with Procedural Macros.</p>
                <p id="c70c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To create the wrapper, we apply
                  the <code class="dm gw gx gy gz b">#[safe_wrap]</code> attribute to the Rust binding created by <code
                    class="dm gw gx gy gz b">bindgen</code>‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/86ee23381b5f9ff9182cc20ca90022dd.js"></script></p>


                </figure>
                <p id="adcb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">#[safe_wrap]</code> is a Procedural Macro <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">defined here</a>‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/13f5b12c2ceda4b81b88e5ca77a64fa6.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="5ede" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro calls <code
                    class="dm gw gx gy gz b"><a href="https://docs.rs/syn/0.15.38/syn/macro.parse_macro_input.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">parse_macro_input</a>!()</code>
                  from the <a
                    href="https://docs.rs/syn/0.15.38/syn/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">syn library</a>. The input to the
                  macro is parsed as an <code class="dm gw gx gy gz b">extern</code> function declaration (denoted by
                  <code class="dm gw gx gy gz b">ItemForeignMod</code>).</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/f91332310b2d9246bccc15f7287ad222.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="c46f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Next, we inspect each parameter
                  of the <code class="dm gw gx gy gz b">extern</code> function and call <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L185-L278" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">transform_arg_list</a>()</code>
                  to transform each parameter into three forms‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/4d48314165ba804987d32f48b1ac0f4a.js"></script></p>


                </figure>
                <p id="e7da" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ <strong class="gj hk">Wrapper
                    Declaration</strong>: How the parameter type is exposed via the wrapped function.</p>
                <p id="b8a0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">For example, <code
                    class="dm gw gx gy gz b">*mut</code> for output pointers looks odd to C coders, so we rename it as
                  <code class="dm gw gx gy gz b">Out&lt;‚Ä¶&gt;</code>, which clearly states the intent (output pointer).
                </p>
                <p id="888e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">*const c_char</code> for input strings is renamed to &amp;Strn, since the
                  <code class="dm gw gx gy gz b">Strn</code> type validates that the string is null-terminated. (Again,
                  <code class="dm gw gx gy gz b">Strn</code> signifies the intent.)</p>
                <p id="ec62" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ <strong
                    class="gj hk">Validation Statement</strong>: To validate each parameter if needed, like verifying
                  that all input strings are null-terminated. (We use the <code class="dm gw gx gy gz b">Strn</code>
                  type to perform the string validation.)</p>
                <p id="7af3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3Ô∏è‚É£ <strong class="gj hk">Call
                    Expression</strong>: Inside the wrapper, use this type cast expression to call the C function. Rust
                  is stricter than C about types, so we use type casting to handle tiny discrepancies like <code
                    class="dm gw gx gy gz b">i32</code> vs <code class="dm gw gx gy gz b">u32</code> (signed vs unsigned
                  integers).</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/b510571b9385cb5ca189ff770789e7c2.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="f9f0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Finally we use <code
                    class="dm gw gx gy gz b"><a href="https://docs.rs/quote/0.6.12/quote/macro.quote.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote!</a></code>
                  macro to combine the three forms into the expanded output below. The <code
                    class="dm gw gx gy gz b">quote!</code> macro clearly shows the structure of the output, thus I
                  <strong class="gj hk">highly recommend </strong><code
                    class="dm gw gx gy gz b"><strong class="gj hk">quote!</strong></code><strong class="gj hk"> for
                    composing Procedural Macros</strong>.</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/11af7179183a66de9fcfc7ac0d124101.js"></script></p>


                </figure>
                <p id="fb27" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We use <code
                    class="dm gw gx gy gz b">quote_spanned!</code> instead of <code
                    class="dm gw gx gy gz b">quote!</code> in some spots‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
           
                  <p><script src="https://gist.github.com/lupyuen/731a7140a8cca00edaf1cc95b4ce7bd6.js"></script></p>


                </figure>
                <p id="91b6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What‚Äôs a <strong
                    class="gj hk">Span</strong>? When the Rust Compiler sends a stream of tokens to our macro, it also
                  transmits the <strong class="gj hk">byte location of each token</strong> in the source file. So when
                  it hits a compilation error, the compiler can display the exact source code that caused the error.</p>
                <p id="e2a1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Our macro is <strong
                    class="gj hk">synthesising source code</strong> ‚Äî creating new source code based on the original
                  source code. So it‚Äôs possible that our synthesised source code will have errors. When that happens, we
                  should tell the Rust Compiler the precise location of the original code.</p>
                <p id="1998" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That‚Äôs why it‚Äôs important for our
                  macros to <strong class="gj hk">preserve the Span information</strong>. We create three forms of each
                  parameter, but they are <strong class="gj hk">placed into different sections</strong>. By using <code
                    class="dm gw gx gy gz b"><a href="https://docs.rs/quote/0.6.12/quote/macro.quote_spanned.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote_spanned!</a></code>
                  we preserve the original Span of each parameter. And the Rust Coder gets <strong
                    class="gj hk">meaningful, relevant error messages.</strong></p>
              </div>
            </div>
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy2/d12.png" /></p>

             
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Overview of the #[safe_wrap] attribute
                </figcaption>
              </figure>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="hb hc hd he hf cz">
                <div class="dl r dd">
                  <div class="lo r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F9aJqXl7TTkc%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D9aJqXl7TTkc&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F9aJqXl7TTkc%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="854"
                      title="Result, Ok and Err in Embedded Rust" class="cp t u dh ak" scrolling="auto"></iframe></div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Result, Ok and Err in Embedded Rust</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="3c2d" class="jo jp ec bk bj jc jq li js lj ju lk jw ll jy lm ka">What are Result&lt;&gt;, Ok()
                  and Err() in Rust?</h1>
                <p id="ade5" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">In Rust, it‚Äôs customary for
                  functions to return <code class="dm gw gx gy gz b">Result&lt;‚Ä¶&gt;</code> instead of an error code
                  like C. That‚Äôs why our Safe Wrapper is declared as‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/026adbd9e9b97f6cd063e376ddf69c47.js"></script></p>


                </figure>
                <p id="e4bb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b"><a href="https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/result/type.MynewtResult.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">MynewtResult</a>&lt;‚Ä¶&gt;</code>
                  (derived from <code
                    class="dm gw gx gy gz b"><a href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Result</a>&lt;‚Ä¶&gt;</code>)
                  is a Generic Type that contains either‚Ä¶</p>
                <p id="21a3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ <code
                    class="dm gw gx gy gz b">Ok(result)</code> in which <code class="dm gw gx gy gz b">result</code> is
                  an optional result value</p>
                <p id="07c7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ <code
                    class="dm gw gx gy gz b">Err(error_code)</code> in which <code
                    class="dm gw gx gy gz b">error_code</code> is the <a
                    href="https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/result/enum.MynewtError.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Mynewt system error code</a></p>
                <p id="e88c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How do we indicate the type of
                  the result value? Through the function definition‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f957" class="kk jp ec bk gz b ds kl km r kn">fn my_function() -&gt; MynewtResult&lt;i32&gt;</span></pre>
                <p id="4b32" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">‚Ä¶means that <code
                    class="dm gw gx gy gz b">my_function()</code> returns an integer result value or an error code.</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="3c12" class="kk jp ec bk gz b ds kl km r kn">fn my_function() -&gt; MynewtResult&lt;()&gt;</span></pre>
                <p id="0590" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">‚Ä¶means that <code
                    class="dm gw gx gy gz b">my_function()</code> returns no result value (a.k.a. <code
                    class="dm gw gx gy gz b">void</code>) but it may return an error code.</p>
                <p id="29f2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To return a result value, we
                  return <code class="dm gw gx gy gz b">Ok(value)</code> or if there‚Äôs nothing to be returned, <code
                    class="dm gw gx gy gz b">Ok(())</code></p>
                <p id="f084" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To return an error, we return a
                  standard Mynewt error code wrapped with <code class="dm gw gx gy gz b">Err()</code> like this: <code
                    class="dm gw gx gy gz b">Err(MynewtError::SYS_EAGAIN)</code></p>
                <p id="7e1f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What happens when we call a
                  function that returns an error? For example‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/f26a458aca6cb7f259e7658fe08842f5.js"></script></p>


                </figure>
                <p id="9a34" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">See the strange <code
                    class="dm gw gx gy gz b">?</code> dangling at the end of the <code
                    class="dm gw gx gy gz b">task_init()</code> function call?</p>
                <p id="a6b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It returns any errors immediately
                  when they occur. The function exits early without executing the rest of the function.</p>
                <p id="c7b1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">So <code
                    class="dm gw gx gy gz b">Result&lt;‚Ä¶&gt;, Ok(‚Ä¶), Err(‚Ä¶)</code> and <code
                    class="dm gw gx gy gz b">?</code> really help to make Mynewt error handling so much easier.</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="ff9e" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Debug Rust Macros with Visual
                  Studio Code</h1>
                <p id="2aa2" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Visual Studio Code is a great way
                  to debug Rust Declarative and Procedural Macros. Just follow these steps‚Ä¶</p>
                <p id="98b2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ Install <a
                    href="https://code.visualstudio.com/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Visual
                      Studio Code</strong></a>. Install <code
                    class="dm gw gx gy gz b"><strong class="gj hk">rustup</strong></code> according to the instructions
                  at <code
                    class="dm gw gx gy gz b"><a href="https://rustup.rs/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">rustup.rs</a></code>
                </p>
                <p id="4467" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ Select the <strong
                    class="gj hk">Nightly Build</strong> of the Rust Compiler‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="2b22" class="kk jp ec bk gz b ds kl km r kn">rustup default nightly<br/>rustup update</span></pre>
                <p id="5d18" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk">3Ô∏è‚É£ For
                    Windows</strong>: Install the <a
                    href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Remote WSL
                      Extension</strong></a> for Visual Studio Code so that the Rust build runs in the Linux (Ubuntu)
                  environment, which has fewer problems. Otherwise you‚Äôll have to install Rust twice according to <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust/README.md"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">these instructions</a>.</p>
                <p id="bc8c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">4Ô∏è‚É£ Install the <a
                    href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Rust
                      Language Support Extension</strong></a> for Visual Studio Code. If it won‚Äôt install properly, <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust/README.md#install-rust-windows"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">check these instructions</a>.</p>
                <p id="fc62" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">5Ô∏è‚É£ Install the <a
                    href="https://marketplace.visualstudio.com/items?itemName=SanaAjani.taskrunnercode"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Task Runner
                      Extension</strong></a> for Visual Studio Code. This lets you click on build tasks easily in the
                  <code class="dm gw gx gy gz b">Task Runner</code> pane at lower left.</p>
                <p id="6645" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">5Ô∏è‚É£ In Visual Studio Code, click
                  <code
                    class="dm gw gx gy gz b"><strong class="gj hk">View ‚Üí Command Palette ‚Üí Git Clone</strong></code>.
                  Enter</p>
                <p id="e832" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">https://github.com/lupyuen/test-rust-macros</code></p>
                <p id="35e1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">and select a local folder. This
                  Rust project contains demo macros used in the next section.</p>
                <p id="9c19" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">6Ô∏è‚É£ When prompted, open the
                  cloned repository and open the workspace</p>
                <p id="235b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">7Ô∏è‚É£ In the <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Workspace</strong></code> pane, open the file <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">src/main.rs</strong></a></code>
                  to view the demo macros. We‚Äôll be using the demo macros next‚Ä¶</p>
                <p id="04d2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here‚Äôs a video of the
                  installation steps. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions‚Ä¶</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F5wh-iiEbtmA%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5wh-iiEbtmA&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F5wh-iiEbtmA%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Expand Rust Macros in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="8bcd" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Watch Macro Expansion in Visual
                  Studio Code</h1>
                <p id="511e" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">To see how simple macros are
                  expanded, use <code class="dm gw gx gy gz b">trace_macros!()</code> like this‚Ä¶</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/2cf4428a85f8ac27bbcb9518eaf1a039.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L170-L176"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L170-L176</a>
                  </figcaption>
                </figure>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>

                
                </figure>
                <figure class="du cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d13.png" /></p>

                
                </figure>
                <p id="9e20" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Mouse over the macro name, like
                  <code class="dm gw gx gy gz b">add_88</code> (located in the <code
                    class="dm gw gx gy gz b">main()</code> function)</p>
                <p id="33e4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro expansion appears in a
                  pop-up</p>
                <p id="9f0e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Peek Problem</strong></code> if the expansion is long
                </p>
                <p id="5ef6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">For complex macros, use this
                  method to view expanded macros in the Rust build log‚Ä¶</p>
                <p id="ebf3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ In Visual Studio Code, browse
                  the <code class="dm gw gx gy gz b">Workspace</code> and open the file <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/test-rust-macros/blob/master/.cargo/config" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">.cargo/config</strong></a></code>
                </p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/dfa6e9d64fbc0c29ed9f7795108ef8d8.js"></script></p>


                </figure>
                <p id="644f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ Uncomment the first option‚Ä¶
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="3480" class="kk jp ec bk gz b ds kl km r kn">&quot;-Z&quot;, &quot;unstable-options&quot;, &quot;--pretty&quot;, &quot;expanded&quot;,</span></pre>
                <p id="f4ee" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3Ô∏è‚É£ Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Terminal ‚Üí Run Task ‚Üí cargo build</strong></code></p>
                <p id="df12" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The expanded macro appears in the
                  <code class="dm gw gx gy gz b">cargo build</code> log‚Ä¶</p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d14.png" /></p>

                
                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Expanded macro in the cargo build log
                  </figcaption>
                </figure>
                <p id="2f36" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">4Ô∏è‚É£ With the Task Runner
                  Extension, we may also click <code class="dm gw gx gy gz b">cargo build</code> in the <code
                    class="dm gw gx gy gz b">Task Runner</code> pane at lower left</p>
                <p id="873d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here‚Äôs a video of the macro
                  expansion. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions‚Ä¶</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F5wh-iiEbtmA%3Fstart%3D91%26feature%3Doembed%26start%3D91&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5wh-iiEbtmA&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F5wh-iiEbtmA%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Expand Rust Macros in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="8a3d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">If you‚Äôre not using Visual Studio
                  Code, run this in the command line to see the expanded macros‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f2fd" class="kk jp ec bk gz b ds kl km r kn">cargo rustc -- -Z unstable-options --pretty expanded</span></pre>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="9f0b" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Macro Hygiene in Rust</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d15.png" /></p>

             
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d16.png" /></p>

               
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d17.png" /></p>

                
                </figure>
                <blockquote class="hh hi hj">
                  <p id="598e" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">More about <a
                      href="https://danielkeep.github.io/tlborm/book/mbe-min-hygiene.html"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Macro Hygiene</a></p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="e621" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Debug Macro Hygiene in Visual
                  Studio Code</h1>
                <p id="250e" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">The Rust Compiler can show us
                  information about the <code class="dm gw gx gy gz b">salt</code> variables and which context they
                  belong to‚Ä¶</p>
                <p id="e1cc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ In Visual Studio Code, browse
                  the <code class="dm gw gx gy gz b">Workspace</code> and open the file <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/test-rust-macros/blob/master/.cargo/config" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">.cargo/config</strong></a></code>
                </p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/dfa6e9d64fbc0c29ed9f7795108ef8d8.js"></script></p>


                </figure>
                <p id="aae1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ Uncomment the second option‚Ä¶
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="64e4" class="kk jp ec bk gz b ds kl km r kn">&quot;-Z&quot;, &quot;unstable-options&quot;, &quot;--pretty&quot;, &quot;expanded,hygiene&quot;,</span></pre>
                <p id="0178" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Check that the first option is
                  commented.</p>
                <p id="c0d4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3Ô∏è‚É£ Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Terminal ‚Üí Run Task ‚Üí cargo build</strong></code></p>
                <p id="07d1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The expanded macro with context
                  information appears in the <code class="dm gw gx gy gz b">cargo build</code> log. Here‚Äôs what it
                  means‚Ä¶</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz mi mj paragraph-image">
                
                    <p><img src="https://lupyuen.github.io/images/legacy2/d18.png" /></p>

                
                    <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Rust Compiler displaying the context of
                      every variable</figcaption>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="73dd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here‚Äôs a video of macro hygiene
                  in Visual Studio Code. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions‚Ä¶</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FUuPab1kXVQo%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DUuPab1kXVQo&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FUuPab1kXVQo%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Rust Macro Hygiene in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="3e88" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">If you‚Äôre not using Visual Studio
                  Code, run this in the command line to see the hygiene information‚Ä¶</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d0fd" class="kk jp ec bk gz b ds kl km r kn">cargo rustc -- -Z unstable-options --pretty expanded,hygiene</span></pre>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="00ee" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Macro Context: Embedded vs
                  Desktop</h1>
                <blockquote class="hh hi hj">
                  <p id="70e5" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">ü§î </em>Macro
                    programming is also known as <a
                      href="https://en.wikipedia.org/wiki/Metaprogramming"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong
                        class="gj hk">Metaprogramming</strong></a>‚Ä¶ Like ‚ÄúInception‚Äù, it <strong class="gj hk">plays
                      weird tricks with your mind</strong>, as you code a program within a program‚Ä¶ And you ask
                    yourself: ‚ÄúWhich level am I at right now? What am I really coding for?‚Äù</p>
                </blockquote>
                <p id="a0c8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We are actually stacked on TWO
                  ‚ÄúInception‚Äù Layers right now‚Ä¶</p>
                <p id="c48d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1Ô∏è‚É£ We‚Äôre coding an Embedded Rust
                  program for STM32 Blue Pill. <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/Cargo.toml#L33" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Cargo.toml</a></code><a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/Cargo.toml#L33"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> is located here</a>.</p>
                <p id="c64c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2Ô∏è‚É£ We‚Äôre coding a Procedural
                  Rust Macro, which transforms the source code of the Embedded Rust program. <code
                    class="dm gw gx gy gz b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/Cargo.toml#L23" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Cargo.toml</a></code><a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/Cargo.toml#L23"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> is located here</a>.</p>
                <p id="a7b2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">They run on different contexts‚Ä¶
                </p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/8c3e54f64e1252b8a5dcf3fa8c9d697b.js"></script></p>


                </figure>
                <p id="bfb3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">So we may make the mistake of
                  adding <a href="https://doc.rust-lang.org/std/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Standard Library</a> features
                  to our Embedded Rust program. Which will produce Rust Compiler errors.</p>
                <p id="a387" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">As we code, always think
                  carefully‚Ä¶ Which level are we coding on?</p>
                <p id="c5a8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Looking for more Embedded Rust on
                  STM32 Blue Pill? Check this out‚Ä¶</p>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Hosting Embedded Rust apps on Apache Mynewt with STM32 Blue
                            Pill</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Build IoT devices the smarter, safer way with Rust and Apache
                              Mynewt</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="jh r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="5217" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">The Lizard Rests</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d19.png" /></p>

                
                </figure>
                <p id="7da3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Check out the latest article on
                  Visual Embedded Rust‚Ä¶</p>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/visual-embedded-rust-programming-with-visual-studio-code-1bc1262e398c?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Visual Embedded Rust Programming with Visual Studio Code</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Create and edit Embedded Rust programs for STM32 Blue Pill
                              and Apache Mynewt‚Ä¶ By dragging and dropping blocks!</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="ml r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="8d6c" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Appendix: Index Of Images</h1>
                <blockquote class="hh hi hj">
                  <p id="c700" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">This section is not meant for
                    humans; it‚Äôs for web crawlers to index the text content of the images</p>
                </blockquote>
                <figure class="hb hc hd he hf cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d20.png" /></p>

               
                </figure>
                <p id="1abc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúHello I‚Äôm MyNewt.
                    I‚Äôm an Embedded OS that runs on Bare Metal‚Äù</em></p>
                <p id="c113" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúYep I‚Äôm open
                    source. Fully fluffy inside.‚Äù</em></p>
                <p id="0c49" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúMany types of
                    microcontrollers. I run on Super Blue Pill too.‚Äù</em></p>
                <p id="1c09" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhy run Mynewt
                    instead of Embedded Rust on bare metal?‚Äù</em></p>
                <p id="d75d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">(Thanks to RedMart
                    for delivering the bare metal cans on Sunday)</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d21.png" /></p>

                
                </figure>
                <p id="0de1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhat‚Äôs wrong with
                    C? The code gets messy when we do something simple‚Ä¶ Like sending a JSON message over CoAP, using
                    macros‚Ä¶‚Äù</em></p>
                <p id="0ca7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúIt‚Äôs almost 2020.
                    Why do coders suffer like this?</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d22.png" /></p>

                
                </figure>
                <p id="1c5d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúHere‚Äôs the
                    solution in Rust‚Ä¶ Simple Clean Rust Code‚Äù</em></p>
                <p id="559f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúJust that the
                    code inside the curly brackets {‚Ä¶} isn‚Äôt really Rust, it‚Äôs JSON‚Äù</em></p>
                <p id="6437" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúHow does Rust
                    support alien languages?‚Äù</em></p>
                <p id="235c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúAnswer: Rust
                    supports them thru Declarative Macros‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d23.png" /></p>

               
                </figure>
                <p id="7619" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Encoding Format:
                    @json or @cbor</em></p>
                <p id="2c4d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Parser State:
                    @object means that we are parsing an object</em></p>
                <p id="6094" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Encoding Context:
                    Required for macro hygiene. Key of JSON entry / Value of JSON entry. Remaining JSON to be
                    parsed</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d24.png" /></p>

               
                </figure>
                <p id="04eb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúMy two-legged
                    friends are now thinking‚Ä¶‚Äù</em></p>
                <p id="63d3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhat if I need to
                    call some code in Embedded C?‚Äù</em></p>
                <p id="e385" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhat if my sensor
                    or network drivers run only on C?‚Äù</em></p>
                <p id="22e2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThe entire Mynewt
                    API is in C‚Ä¶ How do we call that from Rust?‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d25.png" /></p>

               
                </figure>
                <p id="c18d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúRust will let you
                    call any C function, even C functions defined in Mynewt!‚Äù</em></p>
                <p id="08fe" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúAll you need to
                    provide: the Rust bindings for the functions‚Äù</em></p>
                <p id="c008" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhich the bindgen
                    tool can generate automatically‚Äù</em></p>
                <p id="7e17" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThis C
                    declaration‚Ä¶ is transformed into this Rust declaration by bindgen‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d26.png" /></p>

              
                </figure>
                <p id="7903" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWith bindgen we
                    can import all the C functions from Mynewt into Rust‚Ä¶ In a single click!‚Äù</em></p>
                <p id="1faa" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúBut is the
                    imported horde all set to run on BARE METAL?‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d27.png" /></p>

               
                </figure>
                <p id="a315" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúSee how we are
                    rolling on top of Bare Metal? This is highly UNSAFE!‚Äù</em></p>
                <p id="6a69" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWe could tumble
                    down anytime and damage the Bare Metal. Or ourselves‚Äù</em></p>
                <p id="3b50" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúCalling an
                    imported C function from Rust is UNSAFE. Looks ugly too!‚Äù</em></p>
                <p id="53b0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúIn my fantasy,
                    calling a Mynewt function from Rust would be so safe and easy. Like this‚Ä¶‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d28.png" /></p>

              
                </figure>
                <p id="2ed7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWe should call
                    the Mynewt function thru a SAFE wrapper‚Ä¶‚Äù</em></p>
                <p id="7c98" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWrapper checks
                    incoming strings for null termination‚Äù</em></p>
                <p id="1ea9" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWrapper checks
                    that output pointers are valid‚Äù</em></p>
                <p id="64f4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThe SAFE wrapper
                    protects Bare Metal from any damage. SAFER and SIMPLER coding‚Ä¶ the power of Rust!‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d29.png" /></p>

                 
                </figure>
                <p id="6160" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúSometimes working
                    with Rust feels like meeting a Food Safety Inspector‚Ä¶‚Äù</em></p>
                <p id="7e02" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúHEY YOU!!!‚Äù</em></strong></p>
                <p id="b604" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúYes‚Ä¶ Inspector?‚Äù</em></strong></p>
                <p id="80a4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúYou are violating the rules of Safety and Hygiene‚Ä¶ NO LIZARDS
                      ALLOWED!!!‚Äù</em></strong></p>
                <p id="1741" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúI can explain‚Ä¶‚Äù</em></strong></p>
                <p id="840c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúNO LIZARDS ALLOWED!!!‚Äù</em></strong></p>
                <p id="4c25" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúWhat‚Äôs Hygiene?
                    Hygiene is keeping your bathroom clean. Hygiene is keeping your pet lizard‚Äôs cage clean‚Äù</em></p>
                <p id="5439" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúHygiene means
                    Never do sneaky things to fool the Rust Compiler‚Ä¶ Like pretending to be something else with the same
                    name‚Äù</em></p>
                <p id="5572" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThis is very odd
                    but 100% true‚Ä¶ (Ask your Food Safety Inspector): Declarative Macros respect Hygiene, Procedural
                    Macros DO NOT respect Hygiene‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d30.png" /></p>

             
                </figure>
                <p id="51e6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúPretend you‚Äôre
                    running a Restaurant Business (for humans, not lizards). A Food Safety Inspector walks into your
                    restaurant and orders the soup. The Inspector makes a complaint‚Ä¶‚Äù</em></p>
                <p id="e659" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúThere‚Äôs no salt in the soup‚Äù</em></strong></p>
                <p id="680c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúSorry Inspector, I‚Äôm really sure there‚Äôs salt in your Tomato Soup‚Äù</em></strong></p>
                <p id="a868" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúThere‚Äôs no salt in the soup‚Äù</em></strong></p>
                <p id="ac6b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúI wish I could show it to you‚Ä¶ But there‚Äôs really SALT IN YOUR SOUP!‚Äù</em></strong>
                </p>
                <p id="7215" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúThere‚Äôs no salt in the soup‚Äù</em></strong></p>
                <p id="9950" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">‚ÄúI am putting MY FINGER IN THE SOUP‚Ä¶ There‚Äôs REALLY SALT IN THE SOUP!!! Why do you KEEP
                      SAYING THAT???‚Äù</em></strong></p>
                <p id="b104" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThere‚Äôs no salt
                    in the soup‚Äù</em></p>
                <p id="84d8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúAs you bash your
                    head against the menu, you realise one thing‚Ä¶ The menu reads TOMATO SOUP with SEA SALT‚Ä¶ But you
                    served the Inspector TOMATO SOUP with TABLE SALT‚Äù</em></p>
                <p id="51bf" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThe Inspector was
                    right‚Ä¶ There was no SEA SALT in the soup. And SEA SALT is not the same as TABLE SALT, even though we
                    refer to them by the same name: SALT‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d31.png" /></p>

               
                </figure>
                <p id="f011" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúUnfortunately for
                    Rust macro coders, this Hygiene problem is very real‚Ä¶ The </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> that‚Äôs inside the macro
                    here‚Ä¶ Is NOT in the same context as the </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> here‚Ä¶‚Äù</em></p>
                <p id="ada5" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúBecause the
                    contexts are different, the Rust Compiler stops us from using the same </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> from inside and outside the
                    macro‚Ä¶‚Äù</em></p>
                <p id="041c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúThe solution:
                    Pass the salt as a parameter. This forces the Rust Compiler to treat the two </em><code
                    class="dm gw gx gy gz b"><em class="gv">salts</em></code><em class="gv"> as the same‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/d32.png" /></p>

          
                </figure>
                <p id="ab5a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúIn </em><code
                    class="dm gw gx gy gz b"><em class="gv">make_bad_soup()</em></code><em class="gv">: Contexts don‚Äôt
                    match. Rust Compiler fails with Hygiene Error‚Äù</em></p>
                <p id="5d8b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúIn </em><code
                    class="dm gw gx gy gz b"><em class="gv">make_good_soup()</em></code><em class="gv">: Contexts match.
                    Rust Compiler is happy!‚Äù</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                                  
                <p><img src="https://lupyuen.github.io/images/legacy2/d33.png" /></p>

          
                </figure>
                <p id="60ba" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúRust has so many
                    goodies for Embedded Coders‚Ä¶‚Äù</em></p>
                <p id="ccca" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúDo we really want
                    to keep on coding Embedded C forever?‚Äù</em></p>
                <p id="2dee" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúSome of the
                    Arduino and C code I‚Äôve seen‚Ä¶ Made me fall off the tree!‚Äù</em></p>
                <p id="a8a3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúAs you sleep
                    tonight, dream of the safe, clear, simple code that you‚Äôll be writing‚Ä¶ In Embedded Rust‚Äù</em></p>
                <p id="5883" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">‚ÄúI‚Äôm not really
                    green. FOOLED YA!‚Äù</em></p>
              </div>
            </div>
          </section>
        </div>
      </article>
    </div>
  </div>
</body>

</html>
<!--
     FILE ARCHIVED ON 19:40:43 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:29:47 Feb 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  exclusion.robots: 0.263
  captures_list: 1349.757
  LoadShardBlock: 1324.108 (3)
  RedisCDXSource: 0.597
  PetaboxLoader3.datanode: 1356.196 (4)
  esindex: 0.01
  PetaboxLoader3.resolve: 64.294
  exclusion.robots.policy: 0.252
  CDXLines.iter: 22.161 (3)
  load_resource: 127.117
-->